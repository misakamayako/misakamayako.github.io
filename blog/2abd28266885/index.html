<!DOCTYPE html><html lang="zh-hans" class="h-full w-full m-0"> <head><meta charset="utf-8"><link rel="icon" type="image/jepg" href="/favicon.jpg"><meta name="viewport" content="width=device-width"><meta name="google-site-verification" content="-RgOsAO7rMTpJ8vNk8-ILdAA8VmiTEUc9HiUVVTKeEs"><meta name="generator" content="Astro v5.11.0"><title>âœ¨å¾¡å‚ç½‘ç»œ-æµè§ˆå™¨ç«¯é€šè¿‡File Access APIéšè—ä¸‹è½½å®é™…é“¾æ¥çš„æ–¹æ³•âœ¨</title><link rel="stylesheet" href="/_astro/index.CouIsyMu.css">
<style>/*! tailwindcss v4.0.9 | MIT License | https://tailwindcss.com */
.okTgGW_footer{font-size:var(--text-sm,.875rem);line-height:var(--tw-leading,var(--text-sm--line-height,calc(1.25/.875)));color:var(--color-stone-400,#a6a09b);text-align:center;padding-block:calc(var(--spacing,.25rem)*4);border-top-color:var(--color-zinc-50,#fafafa);border-top-style:var(--tw-border-style);background-color:var(--color-slate-900,#0f172b);border-top-width:2px;width:100%}@supports (color:color(display-p3 0 0 0)){.okTgGW_footer{color:var(--color-stone-400,color(display-p3 .647628 .627105 .61098));border-top-color:var(--color-zinc-50,color(display-p3 .980256 .980256 .980256));background-color:var(--color-slate-900,color(display-p3 .0639692 .0891152 .163036))}}@supports (color:lab(0% 0 0)){.okTgGW_footer{color:var(--color-stone-400,lab(66.2166% 1.88047 3.20326));border-top-color:var(--color-zinc-50,lab(98.26% -.0000298023 0));background-color:var(--color-slate-900,lab(7.78673% 1.82345 -15.0537))}}.okTgGW_footer a{text-decoration-line:underline}@property --tw-border-style{syntax:"*";inherits:false;initial-value:solid}
/*! tailwindcss v4.0.9 | MIT License | https://tailwindcss.com */
.q0UmqG_menu{height:calc(var(--spacing,.25rem)*16);padding-right:calc(var(--spacing,.25rem)*16);border-bottom-color:var(--color-zinc-50,#fafafa);border-bottom-style:var(--tw-border-style);text-align:right;border-bottom-width:2px}@supports (color:color(display-p3 0 0 0)){.q0UmqG_menu{border-bottom-color:var(--color-zinc-50,color(display-p3 .980256 .980256 .980256))}}@supports (color:lab(0% 0 0)){.q0UmqG_menu{border-bottom-color:var(--color-zinc-50,lab(98.26% -.0000298023 0))}}.q0UmqG_menu a{padding-inline:calc(var(--spacing,.25rem)*2);padding-block:calc(var(--spacing,.25rem)*2);font-size:var(--text-xl,1.25rem);line-height:var(--tw-leading,var(--text-xl--line-height,calc(1.75/1.25)));color:var(--color-zinc-50,#fafafa);margin-top:calc(var(--spacing,.25rem)*2.5);display:inline-block}@supports (color:color(display-p3 0 0 0)){.q0UmqG_menu a{color:var(--color-zinc-50,color(display-p3 .980256 .980256 .980256))}}@supports (color:lab(0% 0 0)){.q0UmqG_menu a{color:var(--color-zinc-50,lab(98.26% -.0000298023 0))}}@media (hover:hover){.q0UmqG_menu a:hover{--tw-translate-y:calc(var(--spacing,.25rem)*-.5);translate:var(--tw-translate-x)var(--tw-translate-y);color:var(--color-sky-500,#00a5ef)}@supports (color:color(display-p3 0 0 0)){.q0UmqG_menu a:hover{color:var(--color-sky-500,color(display-p3 .219113 .639027 .931479))}}@supports (color:lab(0% 0 0)){.q0UmqG_menu a:hover{color:var(--color-sky-500,lab(63.3038% -18.433 -51.0407))}}}.q0UmqG_menu a{transition-property:color,background-color,border-color,outline-color,text-decoration-color,fill,stroke,--tw-gradient-from,--tw-gradient-via,--tw-gradient-to;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function,cubic-bezier(.4,0,.2,1)));transition-duration:var(--tw-duration,var(--default-transition-duration,.15s));transition-property:transform,translate,scale,rotate;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function,cubic-bezier(.4,0,.2,1)));transition-duration:var(--tw-duration,var(--default-transition-duration,.15s))}.q0UmqG_navLink{padding-inline:calc(var(--spacing,.25rem)*2);padding-block:calc(var(--spacing,.25rem)*2);font-size:var(--text-xl,1.25rem);line-height:var(--tw-leading,var(--text-xl--line-height,calc(1.75/1.25)));color:var(--color-zinc-50,#fafafa);margin-top:calc(var(--spacing,.25rem)*2.5);display:inline-block}@supports (color:color(display-p3 0 0 0)){.q0UmqG_navLink{color:var(--color-zinc-50,color(display-p3 .980256 .980256 .980256))}}@supports (color:lab(0% 0 0)){.q0UmqG_navLink{color:var(--color-zinc-50,lab(98.26% -.0000298023 0))}}@media (hover:hover){.q0UmqG_navLink:hover{color:var(--color-sky-500,#00a5ef)}@supports (color:color(display-p3 0 0 0)){.q0UmqG_navLink:hover{color:var(--color-sky-500,color(display-p3 .219113 .639027 .931479))}}@supports (color:lab(0% 0 0)){.q0UmqG_navLink:hover{color:var(--color-sky-500,lab(63.3038% -18.433 -51.0407))}}}.q0UmqG_navLink{transition:color .4s}.q0UmqG_avatar{float:right;border-radius:.25rem;display:inline-block;overflow:hidden}@property --tw-border-style{syntax:"*";inherits:false;initial-value:solid}@property --tw-translate-x{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-y{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-z{syntax:"*";inherits:false;initial-value:0}
</style>
<link rel="stylesheet" href="/_astro/_slug_.C7rg5Mfo.css"><script type="module" src="/_astro/page.V2R8AmkL.js"></script></head> <body class="w-full h-full flex flex-col">  <div class="bg-slate-800 h-screen flex flex-col"> <div class="bg-slate-700 w-full"> <div class="q0UmqG_avatar"> <img src="/favicon.jpg" width="64" height="64" alt=""> </div> <nav class="q0UmqG_menu"> <a href="/" class="q0UmqG_navLink">home</a> <a href="/blog/" class="q0UmqG_navLink">blog</a> <a href="/dream-map/" class="inline-block">dream map</a> <a href="/album/" class="q0UmqG_navLink">album</a> <a href="/about-me/" class="q0UmqG_navLink">about me</a> </nav> </div> <div class="flex p-4 grow flex-row h-full overflow-hidden"> <aside class="w-1/4 ml-4 md:block min-w-[200px]"> <div class="sticky top-4 space-y-6"> <div class="bg-slate-700 p-4 rounded-lg"> <img src="/avatar.jpg" class="w-16 h-16 rounded-full mx-auto"> <p class="text-white text-center mt-2">ä½œè€…ï¼šmisakamayako</p>  <p class="text-white text-center mt-2">å‘å¸ƒæ—¶é—´ï¼š2024/08/26</p> </div> <div class="bg-slate-700 p-4 rounded-lg"> <h3 class="text-emerald-400 mb-2">ç®€ä»‹</h3> <p class="text-white font-light mb-2">æœ¬æ–‡è¯¦ç»†ä»‹ç»å¦‚ä½•åˆ©ç”¨File Access APIï¼Œåœ¨ä¿è¯ç”¨æˆ·äº¤äº’çš„å‰æä¸‹ï¼Œéšè—æ–‡ä»¶çš„å®é™…ä¸‹è½½é“¾æ¥ï¼Œå¹¶å®‰å…¨åœ°å°†æ–‡ä»¶ä¿å­˜åˆ°æœ¬åœ°ï¼Œæå‡æ–‡ä»¶ä¼ è¾“çš„ç§å¯†æ€§å’Œç”¨æˆ·ä½“éªŒã€‚</p> </div> <!-- 2. æ–‡ç« ç›®å½• --> <!--<div class="bg-slate-700 p-4 rounded-lg">--> <!--    <h3 class="text-emerald-400 mb-2">æœ¬æ–‡ç›®å½•</h3>--> <!--    &lt;!&ndash;<TOC client:load /> &ndash;&gt;--> <!--</div>--> <!-- 3. çƒ­é—¨æ ‡ç­¾ --> <div class="bg-slate-700 p-4 rounded-lg"> <h3 class="text-emerald-400 mb-2">éšä¾¿çœ‹çœ‹</h3> <div class="flex flex-wrap gap-2"> <a class="px-3 py-1 bg-slate-600 rounded-full text-sm text-white hover:bg-emerald-500 transition" href="/blog/undefined/"> Web Worker ç±»å‹æ¦‚è§ˆ </a><a class="px-3 py-1 bg-slate-600 rounded-full text-sm text-white hover:bg-emerald-500 transition" href="/blog/undefined/"> æµè§ˆå™¨ç«¯å¼‚æ­¥æµæ•°æ®èµ„æºç®¡ç† </a><a class="px-3 py-1 bg-slate-600 rounded-full text-sm text-white hover:bg-emerald-500 transition" href="/blog/undefined/"> Object.seal å’Œ Object.freeze çš„åŒºåˆ« </a> </div> </div> </div> </aside> <main class="grow h-full overflow-auto w-3/4 px-8"> <article class="text-white mb-2 prose lg:prose-xl prose-stone
                 prose-headings:text-white prose-strong:text-white prose-code:text-white
                 prose-a:text-violet-200 prose-blockquote:text-stone-100">  <header> <h1>æµè§ˆå™¨ç«¯é€šè¿‡File Access APIéšè—ä¸‹è½½å®é™…é“¾æ¥çš„æ–¹æ³•</h1> </header> <h2 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</h2>
<ol>
<li>ç”±äº <strong>File Access API</strong> ä¼šç›´æ¥æ“ä½œç¡¬ç›˜ä¸Šçš„æ–‡ä»¶ï¼Œå› æ­¤ <strong>å¿…é¡»åœ¨å—ä¿¡ä»»çš„ HTTPS ç¯å¢ƒæˆ– <code>localhost</code> åŸŸåä¸‹ä½¿ç”¨</strong>ã€‚</li>
<li>æ‰€è°“â€œå—ä¿¡ä»»â€æ˜¯æŒ‡ï¼š
<ul>
<li>ç½‘ç«™ä½¿ç”¨ <strong>HTTPS åè®®</strong> ä¸ç”¨æˆ·å»ºç«‹è¿æ¥ï¼›</li>
<li>ç½‘ç«™çš„ <strong>SSL è¯ä¹¦å—ä¿¡ä¸”æœªè¿‡æœŸ</strong>ã€‚</li>
</ul>
</li>
<li>æ•´ä¸ªæµç¨‹éœ€è¦ç”¨æˆ· <strong>ä¸»åŠ¨è§¦å‘</strong>ï¼Œä¸”è§¦å‘çª—å£å†…æµè§ˆå™¨éœ€å¤„äºæ´»è·ƒçŠ¶æ€ï¼›<strong>å¦‚æœå®Œå…¨ç”±ä»£ç è‡ªåŠ¨è§¦å‘ï¼Œå¯èƒ½ä¼šè¢«æµè§ˆå™¨æ‹¦æˆª</strong>ã€‚</li>
<li>è¯¥æ–¹æ³•<strong>æ— æ³•å®Œå…¨é˜²æ­¢ç”¨æˆ·è·å–çœŸå®ä¸‹è½½åœ°å€</strong>ï¼šå› ä¸ºæ–‡ä»¶ä»éœ€ä»è¿œç¨‹åœ°å€è·å–ï¼Œåªæ˜¯ä¸æ˜¾ç¤ºåœ¨æµè§ˆå™¨çš„ä¸‹è½½åˆ—è¡¨ã€‚æœ‰æŠ€æœ¯èƒ½åŠ›çš„ç”¨æˆ·ä»èƒ½è·å–åŸå§‹é“¾æ¥ã€‚</li>
<li><strong>å»ºè®®åœ¨å®é™…åº”ç”¨ä¸­æ£€æŸ¥æµè§ˆå™¨æ”¯æŒæƒ…å†µ</strong>ï¼Œå¦‚æœ‰å¿…è¦ï¼Œä¸ºç”¨æˆ·æä¾›ä¼ ç»Ÿä¸‹è½½æ–¹å¼ä½œä¸ºå¤‡é€‰ã€‚</li>
</ol>
<blockquote>
<p>æœ¬æ–‡æ¡£é¢å‘é«˜çº§å‰ç«¯å¼€å‘è€…ï¼Œæ—¨åœ¨ä»‹ç»å¦‚ä½•å€ŸåŠ© File Access APIï¼Œåœ¨ç¡®ä¿ç”¨æˆ·ä¸»åŠ¨äº¤äº’çš„å‰æä¸‹ï¼Œ<strong>éšè—å®é™…ä¸‹è½½é“¾æ¥</strong>å¹¶å®‰å…¨åœ°å°†æ–‡ä»¶ä¿å­˜è‡³æœ¬åœ°ã€‚æ­¤æ–¹æ¡ˆæå‡äº†ç”¨æˆ·ä½“éªŒä¸éšç§æ€§ï¼Œä½†<strong>ä¸èƒ½å®Œå…¨é˜²æ­¢æœ‰æŠ€æœ¯èƒ½åŠ›çš„ç”¨æˆ·å‘ç°æºåœ°å€</strong>ã€‚</p>
</blockquote>
<h2 id="1-æ–‡ä»¶åŸºæœ¬æ•°æ®è·å–">1. æ–‡ä»¶åŸºæœ¬æ•°æ®è·å–</h2>
<p>å¯¹äºå›ºå®šçš„æ–‡ä»¶åæˆ–è€…æœ‰è§„åˆ™çš„æ–‡ä»¶ï¼Œè¿™äº›æ•°æ®å¯ä»¥äº‹å…ˆçº¦å®šã€‚å¦‚æœæ–‡ä»¶åç­‰ä¿¡æ¯ä¸æ˜¯å›ºå®šçš„æˆ–è€…æœ‰çº¦å®šçš„ï¼Œå¯ä»¥é€šè¿‡<code>fetch</code>å‘èµ·ä¸€æ¬¡<code>head</code>è¯·æ±‚ï¼Œè·å–å“åº”å¤´çš„<code>Content-disposition</code>éƒ¨åˆ†ï¼›ä¾‹å¦‚ï¼Œéœ€è¦ä¸‹è½½çš„æ–‡ä»¶æ˜¯ä¸€ä¸ªtxtæ–‡ä»¶ï¼Œé‚£ä¹ˆå®ƒçš„å“åº”å¤´åº”è¯¥ç±»ä¼¼äº:<code>attachment;filename=testFile.txt</code>ã€‚è¿™æ ·å°±å¯ä»¥è·å–åˆ°æ–‡ä»¶çš„å®é™…åç§°å’Œæ‰©å±•åä»¥åŠæ‰©å±•åå¯¹åº”çš„mimeTypeã€‚
å¦‚æœæ–‡ä»¶ååŒ…å«éasciiç å­—ç¬¦ï¼Œè¿˜éœ€è¦ä½¿ç”¨<code>decodeURIComponent</code>æ–¹æ³•è§£ç æ–‡ä»¶åã€‚</p>
<h2 id="2-è®©ç”¨æˆ·é€‰æ‹©ä¿å­˜æ–‡ä»¶çš„åœ°å€å’Œåç§°">2. è®©ç”¨æˆ·é€‰æ‹©ä¿å­˜æ–‡ä»¶çš„åœ°å€å’Œåç§°</h2>
<p>ä½¿ç”¨ç¬¬ä¸€æ­¥è·å–åˆ°çš„æ•°æ®åˆ›å»ºä¸€ä¸ªä¿å­˜æ–‡ä»¶çš„é…ç½®ï¼Œè¿™é‡Œä¾ç„¶ä»¥txtæ–‡ä»¶ä½œä¸ºä¾‹å­ï¼Œæ ¹æ®æ•°æ®ï¼Œæ–‡ä»¶çš„å»ºè®®åç§°ä¸º<code>testFile</code>,æ‰©å±•åä¸º<code>txt</code>,æ–‡ä»¶ç±»å‹ä¸º<code>text/plain</code>ï¼Œå¦å¤–å¯ä»¥ç»™ä¿å­˜ç±»å‹åŠ ä¸€ä¸ªæè¿°ï¼Œè¿™é‡Œå°±å®šä¸º<code>éœ€è¦ä¿å¯†çš„æ–‡ä»¶</code>ã€‚æ•´ä¸ªç»„è£…èµ·æ¥å°±å¦‚ä¸‹ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> opts</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    suggestedName:</span><span style="color:#9ECBFF">"testFile"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    types: [</span></span>
<span class="line"><span style="color:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#E1E4E8">            description: </span><span style="color:#9ECBFF">"éœ€è¦ä¿å¯†çš„æ–‡ä»¶"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">            accept: { </span><span style="color:#9ECBFF">"text/plain"</span><span style="color:#E1E4E8">: [</span><span style="color:#9ECBFF">".txt"</span><span style="color:#E1E4E8">] },</span></span>
<span class="line"><span style="color:#E1E4E8">        },</span></span>
<span class="line"><span style="color:#E1E4E8">    ],</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>å¦‚æœå­˜åœ¨èƒ½ä¿å­˜ä¸ºå…¶å®ƒç±»å‹æˆ–è€…æè¿°çš„ï¼Œå¯ä»¥åœ¨typesä¸­ç»§ç»­æ·»åŠ ï¼Œæˆ–è€…åœ¨acceptä¸­æ·»åŠ <br>
ç„¶åä½¿ç”¨<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/showSaveFilePicker">showSaveFilePicker api</a>,å°†ä¸Šé¢çš„é…ç½®ä¼ å…¥ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨è°ƒèµ·æ–‡ä»¶ä¿å­˜çš„å¼¹çª—ï¼Œå¹¶ä¸”ä½¿ç”¨ä¸Šè¿°çš„é…ç½®é¡¹ã€‚</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> saveFileHandle</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#B392F0"> showSaveFilePicker</span><span style="color:#E1E4E8">(opts);</span></span></code></pre>
<p><img alt="showFileSavePickerç¤ºä¾‹" loading="lazy" decoding="async" fetchpriority="auto" width="960" height="540" src="/_astro/showFileSavePicker1.fQHESfk2_1yauWi.webp" >
å¦‚æœä¸æƒ³è¦ç”¨æˆ·è‡ªå®šä¹‰æ‰©å±•åå¯ä»¥æ·»åŠ <code>opts.excludeAcceptAllOption=true</code>,é™åˆ¶ç”¨æˆ·åœ¨ä¿å­˜ç±»å‹é€‰é¡¹åªèƒ½ä½¿ç”¨æä¾›çš„æ‰©å±•åè€Œä¸èƒ½åˆ‡æ¢ä¸ºé€šç”¨çš„<code>*.*</code>æ ¼å¼ã€‚<br>
å¦‚æœç”¨æˆ·æ”¾å¼ƒä¿å­˜ï¼Œ<code>showSaveFilePicker</code>ä¼šæŠ›å‡ºä¸€ä¸ª<code>AbortError</code>ã€‚</p>
<h2 id="3-è·å–æ–‡ä»¶ä¸åˆ›å»ºè¯»å†™æµ">3. è·å–æ–‡ä»¶ä¸åˆ›å»ºè¯»å†™æµ</h2>
<p>ä½¿ç”¨fetchæˆ–è€…å…¶ä»–ç½‘ç»œè¯·æ±‚apiè·å–æ–‡ä»¶çš„äºŒè¿›åˆ¶æµï¼Œå¹¶è½¬æ¢ä¸º<code>ArrayBuffer</code>ã€‚å¦‚æœæ–‡ä»¶æ¯”è¾ƒå¤§ï¼Œå»ºè®®åœ¨ä¸‹è½½æ—¶å‘Šè¯‰ç”¨æˆ·ä¸‹è½½è¿›åº¦ï¼Œå¦‚æœæ–‡ä»¶éå¸¸éå¸¸å¤§ï¼Œå¯èƒ½è¿˜éœ€è¦<a href="https://developer.mozilla.org/en-US/docs/Web/API/File_API">File API</a>å’Œ<a href="https://developer.mozilla.org/en-US/docs/Web/API/FetchEvent">FetchEvent</a>ä»¥åŠåˆ†æ®µä¸‹è½½çš„ç»„åˆä½¿ç”¨é˜²æ­¢çˆ†æ‰å†…å­˜ã€‚<br>
è¿™é‡Œç»™ä¸€ä¸ªè·å–æ–‡ä»¶arrayBufferçš„ç¤ºä¾‹</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> response</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#B392F0"> fetch</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'https://example.com/secretList.txt'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> buffer</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> response.</span><span style="color:#B392F0">arrayBuffer</span><span style="color:#E1E4E8">()</span></span></code></pre>
<p>ç„¶åä½¿ç”¨ç”¨æˆ·çš„æ–‡ä»¶å¥æŸ„åˆ›å»ºä¸€ä¸ªå¯å†™æµ</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> writableFileStream</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> saveFileHandle.</span><span style="color:#B392F0">createWritable</span><span style="color:#E1E4E8">()</span></span></code></pre>
<p>ç„¶åå°†æ–‡ä»¶æµå†™å…¥æ–‡ä»¶å°±å¯ä»¥äº†</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">await</span><span style="color:#E1E4E8"> writableFileStream.</span><span style="color:#B392F0">write</span><span style="color:#E1E4E8">(buffer)</span></span></code></pre>
<p>å¦‚æœè¿˜æœ‰æ•°æ®æµåŠ å¯†ï¼Œä¹Ÿå¯ä»¥åœ¨è¿™ä¸€æ­¥è§£å¯†<br>
æœ€åï¼Œä¸è¦å¿˜è®°å…³é—­è¯»å†™æµï¼Œå‘ŠçŸ¥æµè§ˆå™¨ä¸‹è½½å·²ç»ç»“æŸä¸é˜²æ­¢å†…å­˜æ³„æ¼æˆ–é”™è¯¯çš„æ–‡ä»¶å ç”¨</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#E1E4E8">writableFileStream.</span><span style="color:#B392F0">close</span><span style="color:#E1E4E8">()</span></span></code></pre>
<h2 id="4-æœ€ç»ˆçš„ç»“æœ">4. æœ€ç»ˆçš„ç»“æœ</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="javascript"><code><span class="line"><span style="color:#F97583">async</span><span style="color:#F97583"> function</span><span style="color:#B392F0"> saveFile</span><span style="color:#E1E4E8">(){</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> opts</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        suggestedName:</span><span style="color:#9ECBFF">"testFile"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">        types: [</span></span>
<span class="line"><span style="color:#E1E4E8">            {</span></span>
<span class="line"><span style="color:#E1E4E8">                description: </span><span style="color:#9ECBFF">"éœ€è¦ä¿å¯†çš„æ–‡ä»¶"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">                accept: { </span><span style="color:#9ECBFF">"text/plain"</span><span style="color:#E1E4E8">: [</span><span style="color:#9ECBFF">".txt"</span><span style="color:#E1E4E8">] },</span></span>
<span class="line"><span style="color:#E1E4E8">            },</span></span>
<span class="line"><span style="color:#E1E4E8">        ],</span></span>
<span class="line"><span style="color:#E1E4E8">    };</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> saveFileHandle</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#B392F0"> showSaveFilePicker</span><span style="color:#E1E4E8">(opts);</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> response</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#B392F0"> fetch</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'https://example.com/secretList.txt'</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> buffer</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> response.</span><span style="color:#B392F0">arrayBuffer</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> writableFileStream</span><span style="color:#F97583"> =</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> saveFileHandle.</span><span style="color:#B392F0">createWritable</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">    await</span><span style="color:#E1E4E8"> writableFileStream.</span><span style="color:#B392F0">write</span><span style="color:#E1E4E8">(content)</span></span>
<span class="line"><span style="color:#E1E4E8">    writableFileStream.</span><span style="color:#B392F0">close</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="5-è¡¥å……">5. è¡¥å……ï¼š</h2>
<ol>
<li>ç”¨æˆ·æ”¾å¼ƒä¿å­˜æ—¶æŠ›å‡ºçš„<code>AbortError</code>ä¸æ˜¯AbortErrorçš„å®ä¾‹ï¼Œä»–æ˜¯ä¸€ä¸ª<code>DOMException</code>å®ä¾‹ï¼Œåœ¨å¼‚å¸¸å¤„ç†æ—¶ä¸èƒ½ä½¿ç”¨<code>error instanceOf AbortError</code>åˆ¤æ–­, å¯ä»¥ä½¿ç”¨<code>error.name==='AbortError'</code></li>
</ol>  </article> <div class="tags">  </div> </main> </div> <div class="okTgGW_footer"> <p>Supported and developed by&nbsp;
<a href="https://github.com/misakamayako/" target="_blank" rel="noreferrer">misaka mayako</a> </p> <p>
Tech with <a href="https://astro.build/" target="_blank" rel="noreferrer">astro</a>,&nbsp;
<a href="https://tailwindcss.com/" target="_blank" rel="noreferrer">tailwindcss</a>,&nbsp;
        and <a href="https://pm2.keymetrics.io/" target="_blank" rel="noreferrer">pm2</a>,&nbsp;
</p> <p> feed back via <a href="mailto:misakamayaco@qq.com" target="_blank" rel="noreferrer">ğŸ“«</a></p> <a rel="license noreferrer" href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" class="absolute right-6 bottom-6"> <img alt="çŸ¥è¯†å…±äº«è®¸å¯åè®®" class="inlin-block border-0" src="/cc4.0.png"> </a> </div> </div>  </body></html>