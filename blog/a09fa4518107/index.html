<!DOCTYPE html><html lang="zh-hans" class="h-full w-full m-0"> <head><meta charset="utf-8"><link rel="icon" type="image/jepg" href="/favicon.jpg"><meta name="viewport" content="width=device-width"><meta name="google-site-verification" content="-RgOsAO7rMTpJ8vNk8-ILdAA8VmiTEUc9HiUVVTKeEs"><meta name="generator" content="Astro v5.16.11"><title>âœ¨å¾¡å‚ç½‘ç»œ-scheduler.postTaskã€setTimeout å’Œ queueMicrotask çš„å¼‚æ­¥è¡Œä¸ºæ¯”è¾ƒâœ¨</title><link rel="stylesheet" href="/_astro/index.CaRWMvsr.css">
<style>/*! tailwindcss v4.1.18 | MIT License | https://tailwindcss.com */
@layer properties{@supports (((-webkit-hyphens:none)) and (not (margin-trim:inline))) or ((-moz-orient:inline) and (not (color:rgb(from red r g b)))){*,:before,:after,::backdrop{--tw-border-style:solid}}}.okTgGW_footer{font-size:var(--text-sm,.875rem);line-height:var(--tw-leading,var(--text-sm--line-height,calc(1.25/.875)));color:var(--color-stone-400,#a6a09b);text-align:center;padding-block:calc(var(--spacing,.25rem)*4);border-top-color:var(--color-zinc-50,#fafafa);border-top-style:var(--tw-border-style);background-color:var(--color-slate-900,#0f172b);border-top-width:2px;width:100%;position:relative}@supports (color:color(display-p3 0 0 0)){.okTgGW_footer{color:var(--color-stone-400,color(display-p3 .647628 .627105 .61098));border-top-color:var(--color-zinc-50,color(display-p3 .980256 .980256 .980256));background-color:var(--color-slate-900,color(display-p3 .0639692 .0891152 .163036))}}@supports (color:lab(0% 0 0)){.okTgGW_footer{color:var(--color-stone-400,lab(66.2166% 1.88044 3.20326));border-top-color:var(--color-zinc-50,lab(98.26% 0 0));background-color:var(--color-slate-900,lab(7.78673% 1.82345 -15.0537))}}.okTgGW_footer a{text-decoration-line:underline}@property --tw-border-style{syntax:"*";inherits:false;initial-value:solid}
/*! tailwindcss v4.1.18 | MIT License | https://tailwindcss.com */
@layer properties{@supports (((-webkit-hyphens:none)) and (not (margin-trim:inline))) or ((-moz-orient:inline) and (not (color:rgb(from red r g b)))){*,:before,:after,::backdrop{--tw-border-style:solid;--tw-translate-x:0;--tw-translate-y:0;--tw-translate-z:0}}}.q0UmqG_menu{height:calc(var(--spacing,.25rem)*16);padding-right:calc(var(--spacing,.25rem)*16);border-bottom-color:var(--color-zinc-50,#fafafa);border-bottom-style:var(--tw-border-style);text-align:right;border-bottom-width:2px}@supports (color:color(display-p3 0 0 0)){.q0UmqG_menu{border-bottom-color:var(--color-zinc-50,color(display-p3 .980256 .980256 .980256))}}@supports (color:lab(0% 0 0)){.q0UmqG_menu{border-bottom-color:var(--color-zinc-50,lab(98.26% 0 0))}}.q0UmqG_menu a{padding-inline:calc(var(--spacing,.25rem)*2);padding-block:calc(var(--spacing,.25rem)*2);font-size:var(--text-xl,1.25rem);line-height:var(--tw-leading,var(--text-xl--line-height,calc(1.75/1.25)));color:var(--color-zinc-50,#fafafa);margin-top:calc(var(--spacing,.25rem)*2.5);display:inline-block}@supports (color:color(display-p3 0 0 0)){.q0UmqG_menu a{color:var(--color-zinc-50,color(display-p3 .980256 .980256 .980256))}}@supports (color:lab(0% 0 0)){.q0UmqG_menu a{color:var(--color-zinc-50,lab(98.26% 0 0))}}@media (hover:hover){.q0UmqG_menu a:hover{--tw-translate-y:calc(var(--spacing,.25rem)*-.5);translate:var(--tw-translate-x)var(--tw-translate-y);color:var(--color-sky-500,#00a5ef)}@supports (color:color(display-p3 0 0 0)){.q0UmqG_menu a:hover{color:var(--color-sky-500,color(display-p3 .219113 .639027 .931479))}}@supports (color:lab(0% 0 0)){.q0UmqG_menu a:hover{color:var(--color-sky-500,lab(63.3038% -18.433 -51.0407))}}}.q0UmqG_menu a{transition-property:transform,translate,scale,rotate;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function,cubic-bezier(.4,0,.2,1)));transition-duration:var(--tw-duration,var(--default-transition-duration,.15s))}.q0UmqG_navLink{padding-inline:calc(var(--spacing,.25rem)*2);padding-block:calc(var(--spacing,.25rem)*2);font-size:var(--text-xl,1.25rem);line-height:var(--tw-leading,var(--text-xl--line-height,calc(1.75/1.25)));color:var(--color-zinc-50,#fafafa);margin-top:calc(var(--spacing,.25rem)*2.5);display:inline-block}@supports (color:color(display-p3 0 0 0)){.q0UmqG_navLink{color:var(--color-zinc-50,color(display-p3 .980256 .980256 .980256))}}@supports (color:lab(0% 0 0)){.q0UmqG_navLink{color:var(--color-zinc-50,lab(98.26% 0 0))}}@media (hover:hover){.q0UmqG_navLink:hover{color:var(--color-sky-500,#00a5ef)}@supports (color:color(display-p3 0 0 0)){.q0UmqG_navLink:hover{color:var(--color-sky-500,color(display-p3 .219113 .639027 .931479))}}@supports (color:lab(0% 0 0)){.q0UmqG_navLink:hover{color:var(--color-sky-500,lab(63.3038% -18.433 -51.0407))}}}.q0UmqG_navLink{transition:color .4s}.q0UmqG_avatar{float:right;border-radius:.25rem;display:inline-block;overflow:hidden}@property --tw-border-style{syntax:"*";inherits:false;initial-value:solid}@property --tw-translate-x{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-y{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-z{syntax:"*";inherits:false;initial-value:0}
</style>
<link rel="stylesheet" href="/_astro/_slug_.Ch7HxPFz.css"><script type="module" src="/_astro/page.D1uwR3nK.js"></script></head> <body class="w-full h-full flex flex-col">  <div class="bg-slate-800 h-screen flex flex-col"> <div class="bg-slate-700 w-full"> <div class="q0UmqG_avatar"> <img src="/favicon.jpg" width="64" height="64" alt=""> </div> <nav class="q0UmqG_menu"> <a href="/" class="q0UmqG_navLink">home</a> <a href="/blog/" class="q0UmqG_navLink">blog</a> <a href="/utils/" class="q0UmqG_navLink">utils</a> <a href="/dream-map/" class="inline-block">dream map</a> <a href="/album/" class="q0UmqG_navLink">album</a> <a href="/about-me/" class="q0UmqG_navLink">about me</a> </nav> </div> <div class="flex p-4 grow flex-row h-full overflow-hidden"> <aside class="w-1/4 ml-4 md:block min-w-[200px] overflow-auto"> <div class="sticky top-4 space-y-6"> <div class="bg-slate-700 p-4 rounded-lg"> <img src="/avatar.jpg" class="w-16 h-16 rounded-full mx-auto"> <p class="text-white text-center mt-2">ä½œè€…ï¼šmisakamayako</p>  <p class="text-white text-center mt-2">å‘å¸ƒæ—¶é—´ï¼š2025/07/23</p> </div> <div class="bg-slate-700 p-4 rounded-lg"> <h3 class="text-emerald-400 mb-2">ç®€ä»‹</h3> <p class="text-white font-light mb-2">æœ¬ç¯‡æ–‡ç« æ·±å…¥æ¯”è¾ƒäº† scheduler.postTask(fn)ã€setTimeout(fn, 0) å’Œ queueMicrotask(fn) ä¸‰ç§åœ¨æµè§ˆå™¨ä¸­åˆ›å»ºå¼‚æ­¥ä»»åŠ¡çš„æ–¹æ³•ï¼Œè¯¦è§£å®ƒä»¬åœ¨äº‹ä»¶å¾ªç¯ä¸­çš„ä¼˜å…ˆçº§ã€æ€§èƒ½ã€è°ƒåº¦è¡Œä¸ºä¸ä½¿ç”¨åœºæ™¯ï¼Œå¸®åŠ©å¼€å‘è€…åœ¨ä¸åŒæƒ…å¢ƒä¸‹é€‰æ‹©æœ€åˆé€‚çš„å¼‚æ­¥è°ƒåº¦å·¥å…·ã€‚</p> </div> <!-- 2. æ–‡ç« ç›®å½• --> <!--<div class="bg-slate-700 p-4 rounded-lg">--> <!--    <h3 class="text-emerald-400 mb-2">æœ¬æ–‡ç›®å½•</h3>--> <!--    &lt;!&ndash;<TOC client:load /> &ndash;&gt;--> <!--</div>--> <!-- 3. éšæœºæ–‡ç«  --> <div class="bg-slate-700 p-4 rounded-lg"> <h3 class="text-emerald-400 mb-2">éšä¾¿çœ‹çœ‹</h3> <div class="flex flex-wrap gap-2"> <a class="px-3 py-1 bg-slate-600 rounded-full text-sm text-white hover:bg-emerald-500 transition" href="/blog/d2c826b611c2/"> æµè§ˆå™¨ç«¯å¼‚æ­¥æµæ•°æ®èµ„æºç®¡ç† </a><a class="px-3 py-1 bg-slate-600 rounded-full text-sm text-white hover:bg-emerald-500 transition" href="/blog/31aca58e217e/"> Javaæ€§èƒ½è°ƒä¼˜ï¼šä¸ºä½•VarHandleæ˜¯å–ä»£åå°„çš„â€œé“¶å¼¹â€ï¼Ÿ </a><a class="px-3 py-1 bg-slate-600 rounded-full text-sm text-white hover:bg-emerald-500 transition" href="/blog/d3c1a1ce0c18/"> æ·±å…¥è§£æ MVIKotlinï¼šCoroutineExecutor æ³›å‹å‚æ•°å…¨è§£ </a> </div> </div> </div> </aside> <main class="grow h-full overflow-auto w-3/4 px-8"> <article class="text-zinc-200 mb-2 prose lg:prose-xl prose-stone
                 prose-headings:text-current prose-strong:text-current prose-code:text-current
                 prose-a:text-violet-200 prose-blockquote:text-stone-100">  <header> <h1>scheduler.postTaskã€setTimeout å’Œ queueMicrotask çš„å¼‚æ­¥è¡Œä¸ºæ¯”è¾ƒ</h1> </header> <p>åœ¨æµè§ˆå™¨çš„äº‹ä»¶å¾ªç¯æ¨¡å‹ä¸­ï¼Œ<strong>å¾®ä»»åŠ¡</strong>ï¼ˆMicrotaskï¼‰å’Œ<strong>ä»»åŠ¡</strong>ï¼ˆTaskï¼‰æ˜¯ä¸¤ç§ç‹¬ç«‹çš„é˜Ÿåˆ—ã€‚å¾®ä»»åŠ¡é˜Ÿåˆ—ä¼šåœ¨å½“å‰ä»»åŠ¡ç»“æŸåç«‹åˆ»è¢«æ¸…ç©ºï¼ˆæ¸²æŸ“å‰æ‰§è¡Œæ‰€æœ‰å¾®ä»»åŠ¡ï¼‰ï¼Œè€Œä»»åŠ¡åˆ™åœ¨æ¯è½®äº‹ä»¶å¾ªç¯æ‰§è¡Œä¸€ä¸ªä»»åŠ¡åæ‰å¤„ç†å¾®ä»»åŠ¡ã€‚<code>queueMicrotask(fn)</code> å°†å‡½æ•°æ”¾å…¥<strong>å¾®ä»»åŠ¡é˜Ÿåˆ—</strong>ï¼Œå›è°ƒä¼šåœ¨å½“å‰æ‰§è¡Œæ ˆæ¸…ç©ºåé©¬ä¸Šæ‰§è¡Œï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰ã€‚è€Œ <code>setTimeout(fn, 0)</code> å’Œ <code>scheduler.postTask(fn)</code> éƒ½å±äº<strong>ä»»åŠ¡</strong>ï¼Œå®ƒä»¬çš„å›è°ƒå°†åœ¨å½“å‰ä»»åŠ¡å’Œæ‰€æœ‰å¾®ä»»åŠ¡å®Œæˆä¹‹åçš„ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯å›åˆä¸­è¿è¡Œã€‚</p>
<h2 id="è°ƒç”¨æ—¶æœºä¸ä¼˜å…ˆçº§">è°ƒç”¨æ—¶æœºä¸ä¼˜å…ˆçº§</h2>
<ul>
<li>
<p><strong><code>queueMicrotask(fn)</code>ï¼š</strong> å°†å‡½æ•°åŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚å¾®ä»»åŠ¡ä¼šåœ¨å½“å‰å‡½æ•°æ‰§è¡Œå®Œæ¯•ã€è°ƒç”¨æ ˆæ¸…ç©ºåç«‹å³æ‰§è¡Œï¼Œä¸ä¼šè§¦å‘ä¸‹ä¸€è½®äº‹ä»¶å¾ªç¯ã€‚è¿™æ„å‘³ç€åœ¨åŒä¸€è½®å¾ªç¯å†…ï¼Œæ‰€æœ‰å‰ç½®çš„åŒæ­¥ä»£ç æ‰§è¡Œå®Œåï¼Œæ‰€æœ‰å¾®ä»»åŠ¡ä¼šå…ˆäºä»»ä½•ä»»åŠ¡è¿è¡Œã€‚å› æ­¤ï¼Œå¾®ä»»åŠ¡åœ¨å½“å‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•åæ‹¥æœ‰æœ€é«˜çš„ã€ç¡®å®šçš„æ‰§è¡Œä¼˜å…ˆçº§ã€‚</p>
</li>
<li>
<p><strong><code>setTimeout(fn, 0)</code>ï¼š</strong> å°†å‡½æ•°åŠ å…¥ä»»åŠ¡é˜Ÿåˆ—ã€‚æŒ‰ç…§ HTML è§„èŒƒï¼Œ<code>setTimeout(fn, 0)</code> å®é™…ä¸Šä¼šæ¨è¿Ÿè‹¥å¹²æ¯«ç§’ï¼ˆä¸ç¨³å®šï¼Œå—ç¯å¢ƒå½±å“ï¼‰åæ‰§è¡Œã€‚å› æ­¤ï¼Œå…¶å›è°ƒå°†åœ¨æœªæ¥çš„æŸä¸ªä»»åŠ¡ä¸­æ‰§è¡Œã€‚ç°ä»£æµè§ˆå™¨å¯¹è¿ç»­åµŒå¥—çš„ setTimeout è°ƒç”¨æœ‰æœ€å°å»¶è¿Ÿé™åˆ¶ï¼ˆé€šå¸¸ä¸º4msï¼‰ï¼Œå•æ¬¡è°ƒç”¨çš„å®é™…å»¶è¿Ÿä¹Ÿå¯èƒ½å¤§äº0æ¯«ç§’ï¼Œå—æµè§ˆå™¨å·¥ä½œè´Ÿè½½å’ŒèŠ‚æµç­–ç•¥å½±å“ã€‚</p>
</li>
<li>
<p><strong><code>scheduler.postTask(fn, options)</code>ï¼š</strong> å°†å‡½æ•°ä½œä¸º<strong>ä»»åŠ¡</strong>å®‰æ’æ‰§è¡Œã€‚å…¶æ ¸å¿ƒä¼˜åŠ¿åœ¨äºå¯é€šè¿‡ <code>options.priority</code> æŒ‡å®šè¯¥ä»»åŠ¡åœ¨ <code>postTask</code> å†…éƒ¨ç®¡ç†çš„ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ç›¸å¯¹ä¼˜å…ˆçº§ï¼š</p>
<ul>
<li><strong><code>user-blocking</code>ï¼ˆæœ€é«˜ï¼‰ï¼š</strong> ç”¨äºé˜»å¡ç”¨æˆ·äº¤äº’çš„å…³é”®ä»»åŠ¡ï¼Œå¦‚åŠ¨ç”»ã€ç”¨æˆ·è¾“å…¥å¤„ç†ã€‚</li>
<li><strong><code>user-visible</code>ï¼ˆæ¬¡é«˜ï¼Œé»˜è®¤ï¼‰ï¼š</strong> ç”¨äºç”¨æˆ·å¯è§ä½†ä¸å…³é”®çš„ä»»åŠ¡ï¼Œå¦‚é¡µé¢æ¬¡è¦éƒ¨åˆ†æ¸²ã€‚</li>
<li><strong><code>background</code>ï¼ˆæœ€ä½ï¼‰ï¼š</strong> ç”¨äºåå°å¤„ç†ã€æ—¥å¿—ã€ä½ä¼˜å…ˆçº§åˆå§‹åŒ–ç­‰ã€‚</li>
</ul>
</li>
</ul>
<p><strong>æµè§ˆå™¨çš„äº‹ä»¶å¾ªç¯è°ƒåº¦å™¨è´Ÿè´£ä»æ‰€æœ‰å°±ç»ªçš„ä»»åŠ¡é˜Ÿåˆ—ï¼ˆåŒ…æ‹¬ postTask é˜Ÿåˆ—ã€setTimeout é˜Ÿåˆ—ã€DOMäº‹ä»¶é˜Ÿåˆ—ã€ç½‘ç»œäº‹ä»¶é˜Ÿåˆ—ç­‰ï¼‰ä¸­é€‰æ‹©ä¸‹ä¸€ä¸ªè¦æ‰§è¡Œçš„ä»»åŠ¡</strong>ã€‚ é€‰æ‹©ç­–ç•¥é€šå¸¸ä¼˜å…ˆè€ƒè™‘ç”¨æˆ·äº¤äº’çš„å“åº”æ€§ã€‚è¿™æ„å‘³ç€ï¼š</p>
<p>ä¸€ä¸ª <code>user-blocking</code> çš„ <code>postTask</code> ä»»åŠ¡é€šå¸¸ä¼šæ¯”ä¸€ä¸ª <code>background</code> çš„ <code>postTask</code> ä»»åŠ¡æ›´æ—©è·å¾—æ‰§è¡Œæœºä¼šï¼ˆå› ä¸ºå®ƒä»¬åœ¨åŒä¸€ä¸ªé˜Ÿåˆ—å†…éƒ¨æŒ‰ä¼˜å…ˆçº§æ’åºï¼‰ã€‚</p>
<p>ä½†æ˜¯ï¼Œä¸€ä¸ª <code>user-blocking</code> çš„ <code>postTask</code> ä»»åŠ¡ä¸ä¸€å®šä¼šæ¯”ä¸€ä¸ªæ¥è‡ªç”¨æˆ·ç‚¹å‡»äº‹ä»¶å¤„ç†ç¨‹åºçš„ä»»åŠ¡ï¼ˆå±äºäº‹ä»¶é˜Ÿåˆ—ï¼‰æˆ–ä¸€ä¸ª <code>setTimeout(0)</code> çš„ä»»åŠ¡ï¼ˆå±äºå®šæ—¶å™¨é˜Ÿåˆ—ï¼‰æ›´æ—©æ‰§è¡Œã€‚æµè§ˆå™¨çš„è°ƒåº¦å™¨ä¼šæ ¹æ®å…¶å†…éƒ¨ç­–ç•¥ï¼ˆå¦‚ä¼˜å…ˆå¤„ç†ç”¨æˆ·äº¤äº’ï¼‰æ¥å†³å®šå“ªä¸ªé˜Ÿåˆ—çš„å“ªä¸ªä»»åŠ¡å…ˆæ‰§è¡Œã€‚</p>
<p><strong>å› æ­¤ï¼Œ<code>scheduler.postTask</code> çš„ä¼˜å…ˆçº§ä¸»è¦ç”¨äºåŒºåˆ†å¼€å‘è€…è‡ªå·±é€šè¿‡ <code>postTask</code> è°ƒåº¦çš„ä»»åŠ¡ä¹‹é—´çš„ç›¸å¯¹ç´§è¿«æ€§ï¼Œè€Œä¸æ˜¯æä¾›ä¸€ä¸ªè¦†ç›–æ‰€æœ‰ç±»å‹ä»»åŠ¡çš„å…¨å±€ç»å¯¹ä¼˜å…ˆçº§æ’åº</strong>ã€‚ å¾®ä»»åŠ¡ä»ç„¶æ‹¥æœ‰æœ€é«˜çš„ã€ç¡®å®šçš„æ‰§è¡Œä¼˜å…ˆçº§ï¼ˆåœ¨å½“å‰ä»»åŠ¡ç»“æŸåç«‹å³æ‰§è¡Œï¼‰ã€‚</p>
<h2 id="æ€§èƒ½ä¸è°ƒåº¦è¡Œä¸ºå¯¹æ¯”">æ€§èƒ½ä¸è°ƒåº¦è¡Œä¸ºå¯¹æ¯”</h2>
<ul>
<li>
<p><strong><code>queueMicrotask</code>ï¼š</strong> è°ƒåº¦å¼€é”€æä½ï¼Œåªéœ€å°†å‡½æ•°æ¨å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—å³å¯ã€‚æ‰§è¡Œæ—¶æœºé å‰ï¼Œä½†å¦‚æœå¾®ä»»åŠ¡é“¾è¿‡é•¿ä¼šé˜»å¡åç»­ä»»åŠ¡ï¼ˆç”šè‡³å¯¼è‡´é¡µé¢å¡é¡¿ï¼‰ã€‚å¾®ä»»åŠ¡ä¸ä¼šè‡ªåŠ¨è®©å‡ºæ—¶é—´ç‰‡ï¼Œæ‰€æœ‰å¾®ä»»åŠ¡å®Œæˆåæ‰è¿›è¡Œæ¸²æŸ“ï¼Œå› æ­¤é€‚åˆå¾ˆå¿«å°±èƒ½å®Œæˆçš„çŸ­å°ä»»åŠ¡ã€‚</p>
</li>
<li>
<p><strong><code>setTimeout(fn,0)</code>ï¼š</strong> è°ƒåº¦ç›¸å¯¹å»‰ä»·ï¼Œä½†å­˜åœ¨éšæœºå»¶è¿Ÿå¸¦æ¥çš„ç²¾åº¦ä¸ç¡®å®šæ€§ã€‚ç”±äºå›è°ƒè¢«æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼Œ<code>setTimeout</code> å¯ä»¥åœ¨æ‰§è¡Œé—´éš™è®©å‡ºä¸»çº¿ç¨‹ç»™æµè§ˆå™¨æ¸²æŸ“å’Œå…¶ä»–äº‹ä»¶å¤„ç†ï¼Œå› æ­¤é€‚åˆåˆ†ç‰‡æ‰§è¡Œè¾ƒå¤§ä»»åŠ¡ã€‚ç¼ºç‚¹æ˜¯æ²¡æœ‰ä¼˜å…ˆçº§ï¼Œä¸”å¤§é‡å®šæ—¶å™¨å¯èƒ½å¯¼è‡´è°ƒåº¦æ‹¥å µã€‚</p>
</li>
<li>
<p><strong><code>scheduler.postTask</code>ï¼š</strong> åŸç”Ÿå®ç°å¼€é”€å¾ˆå°ï¼Œæ˜¯æµè§ˆå™¨å†…éƒ¨è°ƒåº¦å±‚çš„ç®€å•å°è£…ã€‚å®ƒæ“…é•¿å°†å¤§ä»»åŠ¡æ‹†åˆ†æˆå¤šä¸ªå°çš„ä»»åŠ¡ï¼Œè®©æµè§ˆå™¨åœ¨ä»»åŠ¡ä¹‹é—´æ’å…¥æ¸²æŸ“å’Œç”¨æˆ·äº‹ä»¶å¤„ç†ã€‚<code>scheduler.postTask</code> æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œå¼€å‘è€…å¯ä»¥åˆ©ç”¨å®ƒï¼ˆä¾‹å¦‚ç»“åˆ <code>await</code>ï¼‰ä¸»åŠ¨å°†ä¸€ä¸ªå¤§ä»»åŠ¡åˆ†è§£æˆå¤šä¸ªè¾ƒå°çš„ã€ç‹¬ç«‹è°ƒåº¦çš„å›è°ƒå‡½æ•°ã€‚é€šè¿‡ç²¾å¿ƒè®¾è®¡è¿™ç§æ‹†åˆ†ï¼Œå¯ä»¥ä½¿æ¯ä¸ªå°å›è°ƒçš„æ‰§è¡Œæ—¶é—´æ§åˆ¶åœ¨è¾ƒçŸ­èŒƒå›´å†…ï¼ˆå¦‚å°äº50msï¼‰ï¼Œä»è€Œé¿å…é˜»å¡ä¸»çº¿ç¨‹è¿‡ä¹…çš„é•¿ä»»åŠ¡ï¼Œæé«˜åº”ç”¨çš„å“åº”æ€§ã€‚</p>
</li>
</ul>
<h2 id="ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹">ä½¿ç”¨åœºæ™¯ä¸¾ä¾‹</h2>
<ul>
<li>
<p><strong><code>queueMicrotask</code> é€‚ç”¨ï¼š</strong> å½“éœ€è¦åœ¨å½“å‰ä»£ç æ‰§è¡Œç»“æŸåâ€œç«‹å³â€æ‰§è¡Œä¸€äº›å°æ“ä½œï¼Œä½†åˆä¸èƒ½ä¸­æ–­å½“å‰ä»»åŠ¡æ—¶ã€‚ä¾‹å¦‚ï¼Œåœ¨å‡½æ•°å†…éƒ¨æ›´æ–°çŠ¶æ€åæƒ³è¦å¼‚æ­¥é€šçŸ¥ã€æˆ–åœ¨æ¡ä»¶åˆ†æ”¯ä¸­åŒæ­¥å’Œå¼‚æ­¥å¤„ç†ä¿æŒä¸€è‡´ï¼Œå¯ä»¥ä½¿ç”¨ <code>queueMicrotask</code> ä¿è¯é¡ºåºä¸€è‡´ã€‚å®ƒç±»ä¼¼äº <code>Promise.then()</code>ï¼Œå¸¸è§äºæ¡†æ¶å†…éƒ¨æˆ–åº“ä¸­å¯¹å¾®ä»»åŠ¡è°ƒåº¦çš„éœ€æ±‚ã€‚</p>
</li>
<li>
<p><strong><code>setTimeout(fn, 0)</code> é€‚ç”¨ï¼š</strong> ä¼ ç»Ÿåœ°ç”¨äºå°†å·¥ä½œæ¨è¿Ÿåˆ°ä¸‹ä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œä»¥ä¾¿è®©æµè§ˆå™¨å…ˆæ›´æ–° UI å†ç»§ç»­æ‰§è¡Œã€‚å¦‚åœ¨å¤„ç†å¤§é‡æ•°æ®æˆ–å¾ªç¯æ—¶ï¼Œé€šè¿‡ <code>setTimeout</code> åˆ†æ®µæ‰§è¡Œé¿å…é˜»å¡é¡µé¢äº¤äº’ï¼›æˆ–åœ¨ <code>onload</code>ã€<code>onclick</code> ç­‰äº‹ä»¶ä¸­å»¶è¿Ÿæ‰§è¡ŒæŸäº›éå…³é”®æ“ä½œï¼ˆå› ä¸ºå®ƒå…¼å®¹æ€§æœ€å¥½ï¼‰ã€‚ä¾‹å¦‚ï¼Œè‹¥è¦åˆ†æ‰¹åŠ è½½æ•°æ®è¡¨æ ¼æˆ–æ‹†åˆ†åŠ¨ç”»å¸§ï¼Œå¯ä»¥ç”¨ <code>setTimeout(fn,0)</code> è®©æ“ä½œå¼‚æ­¥åŒ–ã€‚</p>
</li>
<li>
<p><strong><code>scheduler.postTask</code> é€‚ç”¨ï¼š</strong> é€‚ç”¨äºéœ€è¦æ›´ç»†è‡´è°ƒåº¦å’Œä¼˜å…ˆçº§æ§åˆ¶çš„åœºæ™¯ã€‚æ¯”å¦‚å°†æ¸²æŸ“é€»è¾‘ã€è¾“å…¥å¤„ç†ç­‰å…³é”®ä»»åŠ¡è®¾ç½®ä¸º <code>user-blocking</code>ï¼Œåå°æ•°æ®åŠ è½½æˆ–æ—¥å¿—å¤„ç†è®¾ä¸º <code>background</code>ã€‚åœ¨ React ç­‰æ¡†æ¶ä¸­ï¼Œå¯ä»¥ç”¨å®ƒæ¥æ‹†åˆ†æ¸²æŸ“å·¥ä½œã€å»¶åä¸é‡è¦çš„è®¡ç®—ï¼Œæå‡äº¤äº’æ€§èƒ½ã€‚ä¾‹å¦‚ä½¿ç”¨ <code>await scheduler.postTask(() => task)</code> æŠŠä¸€ä¸ªå¤§å‡½æ•°åˆ†æˆå¤šä¸ªå°å‡½æ•°è¿è¡Œï¼›æˆ–ä½¿ç”¨ <code>TaskController</code> çš„ä¿¡å·åœ¨ç»„ä»¶å¸è½½æ—¶å–æ¶ˆæŒ‚èµ·çš„ä»»åŠ¡ã€‚å†å¦‚å›¾ç‰‡æ‡’åŠ è½½ï¼Œåˆ©ç”¨ <code>postTask</code> å»¶è¿Ÿå¯åŠ¨é¢„åŠ è½½ï¼Œå¹¶å¯åœ¨ç”¨æˆ·ç¦»å¼€æ—¶ä¸­æ­¢ï¼Œæ­£å¦‚ Airbnb ç­‰å…¬å¸åœ¨æ€§èƒ½ä¼˜åŒ–ä¸­æ‰€å®è·µçš„ã€‚</p>
</li>
</ul>
<h2 id="ä¼˜ç¼ºç‚¹æ¯”è¾ƒä¸å»ºè®®">ä¼˜ç¼ºç‚¹æ¯”è¾ƒä¸å»ºè®®</h2>
<ul>
<li>
<p><strong><code>queueMicrotask</code>ï¼š</strong>ï¼š</p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šæ— å»¶è¿Ÿã€ç´§æ¥å½“å‰ä»»åŠ¡åæ‰§è¡Œã€å¼€é”€å°ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šä¼˜å…ˆçº§è¿‡é«˜ï¼Œè‹¥å¾®ä»»åŠ¡è¿‡å¤šä¼šå»¶è¿Ÿä»»åŠ¡å’Œæ¸²æŸ“ï¼Œå¯èƒ½å¼•å‘æ€§èƒ½é—®é¢˜ï¼›æ— æ³•æŒ‡å®šå»¶è¿Ÿæˆ–ä¼˜å…ˆçº§ã€‚</li>
<li><strong>å»ºè®®</strong>ï¼šä»…ç”¨äºçŸ­å°ã€é«˜ä¼˜å…ˆçº§çš„å›è°ƒï¼ˆå¦‚çŠ¶æ€æ›´æ–°åçš„é€šçŸ¥æˆ–éœ€è¦ä¿è¯é¡ºåºçš„é€»è¾‘ï¼‰ï¼Œé¿å…åœ¨å…¶ä¸­åšè€—æ—¶æ“ä½œã€‚</li>
</ul>
</li>
<li>
<p><strong><code>setTimeout(fn, 0)</code>ï¼š</strong></p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šç®€å•å…¼å®¹ã€è‡ªåŠ¨è®©å‡ºæµè§ˆå™¨èµ„æºã€å¯æ‹†åˆ†é•¿ä»»åŠ¡ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šå­˜åœ¨éšæœºå»¶è¿Ÿã€ç²¾åº¦ä½ã€æ— ä¼˜å…ˆçº§æ§åˆ¶ï¼Œä¼šå—åˆ°æµè§ˆå™¨èŠ‚æµç­–ç•¥å½±å“ã€‚</li>
<li><strong>å»ºè®®</strong>ï¼šéœ€è¦åœ¨ä¸å½±å“ UI çš„æƒ…å†µä¸‹å»¶åæ‰§è¡Œä»»åŠ¡æ—¶ä½¿ç”¨ï¼›å½“æµè§ˆå™¨ä¸æ”¯æŒ <code>postTask</code> æ—¶å¯ç”¨ä½œå…¼å®¹æ›¿ä»£ï¼›æˆ–åœ¨ä»»åŠ¡æ‹†åˆ†æ—¶ç”¨ä½œç®€æ˜“åˆ†ç‰‡æ‰‹æ®µã€‚</li>
</ul>
</li>
<li>
<p><strong><code>scheduler.postTask</code>ï¼š</strong></p>
<ul>
<li><strong>ä¼˜ç‚¹</strong>ï¼šæ”¯æŒæŒ‡å®šä¼˜å…ˆçº§å’Œå–æ¶ˆä¿¡å·ï¼Œå¯æ ¹æ®ç´§æ€¥ç¨‹åº¦è°ƒåº¦ä»»åŠ¡ï¼›åŸç”Ÿæœºåˆ¶ä¸‹å¯å°†é•¿ä»»åŠ¡æ‹†åˆ†ï¼Œæé«˜é¡µé¢å“åº”æ€§ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šç›®å‰æ”¯æŒåº¦æœ‰é™ï¼ˆSafari ç­‰æµè§ˆå™¨å°šä¸æ”¯æŒï¼‰ã€éœ€è¦ <code>polyfill</code>ï¼ˆä¼šå¯¼è‡´éƒ¨åˆ†åŠŸèƒ½å¤±æ•ˆï¼‰ï¼Œä¸”å¯¹ç®€å•ä½¿ç”¨åœºæ™¯å¯èƒ½è¿‡åº¦å¤æ‚ã€‚</li>
<li><strong>å»ºè®®</strong>ï¼šåœ¨ç°ä»£æµè§ˆå™¨ç¯å¢ƒä¸‹ï¼Œå¯¹éœ€è¦ç²¾ç»†è°ƒåº¦ã€ä¼˜å…ˆçº§åŒºåˆ†çš„å¤æ‚åº”ç”¨ä½¿ç”¨ï¼›å¦‚æœé¡¹ç›®ä¸­éœ€å…¼å®¹ä¸æ”¯æŒçš„æµè§ˆå™¨ï¼Œå¯ç»“åˆ <code>polyfill</code> æˆ–é€€å›ä½¿ç”¨ <code>setTimeout</code>ã€‚</li>
</ul>
</li>
</ul>
<p>ç»¼ä¸Šï¼Œä¸åŒåœºæ™¯ä¸‹é€‰æ‹©ä¸åŒå·¥å…·ï¼šå¦‚æœåªéœ€åœ¨å½“å‰å‡½æ•°åç«‹å³æ‰§è¡Œå°ä»»åŠ¡ï¼Œå¯ç”¨ <code>queueMicrotask(fn)</code>ï¼›å¦‚æœéœ€è¦ä¸‹ä¸€ä¸ªå¾ªç¯æ‰§è¡Œä»»åŠ¡å¹¶è®© UI æ›´æ–°ï¼Œç”¨ <code>setTimeout(fn, 0)</code>ï¼›è‹¥éœ€è¦è·¨äº‹ä»¶å¾ªç¯çš„ä¼˜å…ˆçº§è°ƒåº¦å’Œå–æ¶ˆæ§åˆ¶ï¼Œå¹¶ä¸”ç¯å¢ƒæ”¯æŒï¼Œåˆ™ä¼˜å…ˆè€ƒè™‘ <code>scheduler.postTask(fn, options)</code>ã€‚</p>
<blockquote>
<p><strong>å‚è€ƒèµ„æ–™ï¼š</strong> MDN æ–‡æ¡£å’Œç›¸å…³æŠ€æœ¯åšå®¢ã€‚</p>
</blockquote>  </article> <div class="tags"> <div class="_tailmateTag_u5zwa_5"> <a href="/blog/tag/JavaScript/">JavaScript</a> </div><div class="_tailmateTag_u5zwa_5"> <a href="/blog/tag/å¼‚æ­¥ç¼–ç¨‹/">å¼‚æ­¥ç¼–ç¨‹</a> </div><div class="_tailmateTag_u5zwa_5"> <a href="/blog/tag/æ€§èƒ½ä¼˜åŒ–/">æ€§èƒ½ä¼˜åŒ–</a> </div> </div> </main> </div> <div class="okTgGW_footer"> <p>Supported and developed by&nbsp;
<a href="https://github.com/misakamayako/" target="_blank" rel="noreferrer">misaka mayako</a> </p> <p>
Tech with <a href="https://astro.build/" target="_blank" rel="noreferrer">astro</a>,&nbsp;
<a href="https://tailwindcss.com/" target="_blank" rel="noreferrer">tailwindcss</a>,&nbsp;
        and <a href="https://pm2.keymetrics.io/" target="_blank" rel="noreferrer">pm2</a>,&nbsp;
</p> <p> feed back via <a href="mailto:misakamayaco@qq.com" target="_blank" rel="noreferrer">ğŸ“«</a></p> <a rel="license noreferrer" href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" class="absolute right-6 bottom-6"> <img alt="çŸ¥è¯†å…±äº«è®¸å¯åè®®" class="inlin-block border-0" src="/cc4.0.png"> </a> </div> </div> <script type="module" is:global>
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('pre').forEach((block) => {
                const button = document.createElement('button')
                button.innerText = 'å¤åˆ¶'
                button.className =
                    'absolute top-2 right-2 bg-slate-800 text-white px-2 py-1 rounded text-sm opacity-50 hover:opacity-100 transition cursor-pointer'
                button.addEventListener('click', () => {
                    const code = block.querySelector('code')
                    if (code) {
                        navigator.clipboard.writeText(code.innerText).then(() => {
                            button.innerText = 'å·²å¤åˆ¶ï¼'
                            setTimeout(() => (button.innerText = 'å¤åˆ¶'), 1000)
                        })
                    }
                })
                block.classList.add('relative')
                block.appendChild(button)
            })
        })
    </script>  </body></html>