<!DOCTYPE html><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha512-fHwaWebuwA7NSF5Qg/af4UeDx9XqUpYpOGgubo3yWu+b2IQR4UeQwbb42Ti7gVAjNtVoI/I9TEoYeu9omwcC6g==" crossorigin="anonymous"><html lang="zh-hans" class="h-full w-full m-0"> <head><meta charset="utf-8"><link rel="icon" type="image/jepg" href="/favicon.jpg"><meta name="viewport" content="width=device-width"><meta name="google-site-verification" content="-RgOsAO7rMTpJ8vNk8-ILdAA8VmiTEUc9HiUVVTKeEs"><meta name="generator" content="Astro v5.17.2"><title>âœ¨å¾¡å‚ç½‘ç»œ-æ·±å…¥ç†è§£ Kotlin å†·æµ (Cold Flow)ï¼šå¼‚æ­¥æ•°æ®æµçš„åŸºç¡€âœ¨</title><link rel="stylesheet" href="/_astro/index.C6IHRFDG.css">
<style>/*! tailwindcss v4.1.18 | MIT License | https://tailwindcss.com */
@layer properties{@supports (((-webkit-hyphens:none)) and (not (margin-trim:inline))) or ((-moz-orient:inline) and (not (color:rgb(from red r g b)))){*,:before,:after,::backdrop{--tw-border-style:solid}}}.okTgGW_footer{font-size:var(--text-sm,.875rem);line-height:var(--tw-leading,var(--text-sm--line-height,calc(1.25/.875)));color:var(--color-stone-400,#a6a09b);text-align:center;padding-block:calc(var(--spacing,.25rem)*4);border-top-color:var(--color-zinc-50,#fafafa);border-top-style:var(--tw-border-style);background-color:var(--color-slate-900,#0f172b);border-top-width:2px;width:100%;position:relative}@supports (color:color(display-p3 0 0 0)){.okTgGW_footer{color:var(--color-stone-400,color(display-p3 .647628 .627105 .61098));border-top-color:var(--color-zinc-50,color(display-p3 .980256 .980256 .980256));background-color:var(--color-slate-900,color(display-p3 .0639692 .0891152 .163036))}}@supports (color:lab(0% 0 0)){.okTgGW_footer{color:var(--color-stone-400,lab(66.2166% 1.88044 3.20326));border-top-color:var(--color-zinc-50,lab(98.26% 0 0));background-color:var(--color-slate-900,lab(7.78673% 1.82345 -15.0537))}}.okTgGW_footer a{text-decoration-line:underline}@property --tw-border-style{syntax:"*";inherits:false;initial-value:solid}
/*! tailwindcss v4.1.18 | MIT License | https://tailwindcss.com */
@layer properties{@supports (((-webkit-hyphens:none)) and (not (margin-trim:inline))) or ((-moz-orient:inline) and (not (color:rgb(from red r g b)))){*,:before,:after,::backdrop{--tw-border-style:solid;--tw-translate-x:0;--tw-translate-y:0;--tw-translate-z:0}}}.q0UmqG_menu{height:calc(var(--spacing,.25rem)*16);padding-right:calc(var(--spacing,.25rem)*16);border-bottom-color:var(--color-zinc-50,#fafafa);border-bottom-style:var(--tw-border-style);text-align:right;border-bottom-width:2px}@supports (color:color(display-p3 0 0 0)){.q0UmqG_menu{border-bottom-color:var(--color-zinc-50,color(display-p3 .980256 .980256 .980256))}}@supports (color:lab(0% 0 0)){.q0UmqG_menu{border-bottom-color:var(--color-zinc-50,lab(98.26% 0 0))}}.q0UmqG_menu a{padding-inline:calc(var(--spacing,.25rem)*2);padding-block:calc(var(--spacing,.25rem)*2);font-size:var(--text-xl,1.25rem);line-height:var(--tw-leading,var(--text-xl--line-height,calc(1.75/1.25)));color:var(--color-zinc-50,#fafafa);margin-top:calc(var(--spacing,.25rem)*2.5);display:inline-block}@supports (color:color(display-p3 0 0 0)){.q0UmqG_menu a{color:var(--color-zinc-50,color(display-p3 .980256 .980256 .980256))}}@supports (color:lab(0% 0 0)){.q0UmqG_menu a{color:var(--color-zinc-50,lab(98.26% 0 0))}}@media (hover:hover){.q0UmqG_menu a:hover{--tw-translate-y:calc(var(--spacing,.25rem)*-.5);translate:var(--tw-translate-x)var(--tw-translate-y);color:var(--color-sky-500,#00a5ef)}@supports (color:color(display-p3 0 0 0)){.q0UmqG_menu a:hover{color:var(--color-sky-500,color(display-p3 .219113 .639027 .931479))}}@supports (color:lab(0% 0 0)){.q0UmqG_menu a:hover{color:var(--color-sky-500,lab(63.3038% -18.433 -51.0407))}}}.q0UmqG_menu a{transition-property:transform,translate,scale,rotate;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function,cubic-bezier(.4,0,.2,1)));transition-duration:var(--tw-duration,var(--default-transition-duration,.15s))}.q0UmqG_navLink{padding-inline:calc(var(--spacing,.25rem)*2);padding-block:calc(var(--spacing,.25rem)*2);font-size:var(--text-xl,1.25rem);line-height:var(--tw-leading,var(--text-xl--line-height,calc(1.75/1.25)));color:var(--color-zinc-50,#fafafa);margin-top:calc(var(--spacing,.25rem)*2.5);display:inline-block}@supports (color:color(display-p3 0 0 0)){.q0UmqG_navLink{color:var(--color-zinc-50,color(display-p3 .980256 .980256 .980256))}}@supports (color:lab(0% 0 0)){.q0UmqG_navLink{color:var(--color-zinc-50,lab(98.26% 0 0))}}@media (hover:hover){.q0UmqG_navLink:hover{color:var(--color-sky-500,#00a5ef)}@supports (color:color(display-p3 0 0 0)){.q0UmqG_navLink:hover{color:var(--color-sky-500,color(display-p3 .219113 .639027 .931479))}}@supports (color:lab(0% 0 0)){.q0UmqG_navLink:hover{color:var(--color-sky-500,lab(63.3038% -18.433 -51.0407))}}}.q0UmqG_navLink{transition:color .4s}.q0UmqG_avatar{float:right;border-radius:.25rem;display:inline-block;overflow:hidden}@property --tw-border-style{syntax:"*";inherits:false;initial-value:solid}@property --tw-translate-x{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-y{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-z{syntax:"*";inherits:false;initial-value:0}
</style>
<link rel="stylesheet" href="/_astro/_slug_.aUcrWOZv.css"><script type="module" src="/_astro/page.D1uwR3nK.js"></script></head> <body class="w-full h-full flex flex-col"> <div class="bg-slate-800 h-screen flex flex-col"><div class="bg-slate-700 w-full"> <div class="q0UmqG_avatar"> <img src="/favicon.jpg" width="64" height="64" alt=""> </div> <nav class="q0UmqG_menu"> <a href="/" class="q0UmqG_navLink">home</a> <a href="/blog/" class="q0UmqG_navLink">blog</a> <a href="/utils/" class="q0UmqG_navLink">utils</a> <a href="/dream-map/" class="inline-block">dream map</a> <a href="/album/" class="q0UmqG_navLink">album</a> <a href="/about-me/" class="q0UmqG_navLink">about me</a> </nav> </div><div class="flex p-4 grow flex-row h-full overflow-hidden"><aside class="w-1/4 ml-4 md:block min-w-[200px] overflow-auto pr-2"><div class="sticky top-4 space-y-6"><div class="bg-slate-700 p-4 rounded-lg"><img src="/avatar.jpg" class="w-16 h-16 rounded-full mx-auto"><p class="text-white text-center mt-2">ä½œè€…ï¼šmisakamayako</p><p class="text-white text-center mt-2">å‘å¸ƒæ—¶é—´ï¼š2025/11/13</p></div><div class="bg-slate-700 p-4 rounded-lg"><h3 class="text-emerald-400 mb-2">ç®€ä»‹</h3><p class="text-white font-light mb-2">æœ¬æ–‡æ·±å…¥æ¢è®¨äº† Kotlin åç¨‹ä¸­çš„æ ¸å¿ƒæ¦‚å¿µâ€”â€”å†·æµ (Cold Flow)ã€‚æ–‡ç« é€šè¿‡ç”ŸåŠ¨çš„â€œç‚¹æ’­è§†é¢‘â€ç±»æ¯”ï¼Œè¯¦ç»†è§£é‡Šäº†å†·æµçš„æƒ°æ€§æœ¬è´¨ï¼Œå³åªæœ‰åœ¨è¢«è®¢é˜…æ—¶æ‰ä¼šæ‰§è¡Œã€‚å°†å­¦ä¹ åˆ°å†·æµçš„æ ¸å¿ƒç‰¹æ€§ï¼ŒåŒ…æ‹¬å…¶ç‹¬ç«‹çš„æ‰§è¡Œå®ä¾‹ã€å¤©ç„¶çš„èƒŒå‹æœºåˆ¶ä»¥åŠä¸ä¼ ç»Ÿé›†åˆç›¸æ¯”åœ¨å†…å­˜æ•ˆç‡å’Œå¼‚æ­¥å¤„ç†ä¸Šçš„å·¨å¤§ä¼˜åŠ¿ã€‚æ­¤å¤–ï¼Œæ–‡ç« è¿˜æ¶µç›–äº† buffer æ“ä½œç¬¦å¯¹æ•°æ®æµçš„å½±å“ï¼Œå¹¶é€šè¿‡å¤„ç†å¤§å‹æ–‡ä»¶çš„å®æˆ˜æ¡ˆä¾‹ï¼Œç›´è§‚å±•ç¤ºäº†å†·æµåœ¨æ€§èƒ½ä¼˜åŒ–ä¸­çš„å¼ºå¤§ä½œç”¨ã€‚</p></div><!-- 2. å…³è”æ–‡ç«  --><!-- 3. éšæœºæ–‡ç«  --><div class="bg-slate-700 p-4 rounded-lg"><h3 class="text-emerald-400 mb-2">éšä¾¿çœ‹çœ‹</h3><div class="flex flex-wrap gap-2"><a class="px-3 py-1 bg-slate-600 rounded-full text-sm text-white hover:bg-emerald-500 transition" href="/blog/2b6de1fc1e65/">åŸºäºKotlinåç¨‹çš„é«˜æ•ˆå¼‚æ­¥æ–‡ä»¶ä¸Šä¼ æœåŠ¡è®¾è®¡ä¸å®ç°</a><a class="px-3 py-1 bg-slate-600 rounded-full text-sm text-white hover:bg-emerald-500 transition" href="/blog/31aca58e217e/">Javaæ€§èƒ½è°ƒä¼˜ï¼šä¸ºä½•VarHandleæ˜¯å–ä»£åå°„çš„â€œé“¶å¼¹â€ï¼Ÿ</a><a class="px-3 py-1 bg-slate-600 rounded-full text-sm text-white hover:bg-emerald-500 transition" href="/blog/88fe8af400de/">JDK 22 FFM API ä¸ä¼ ç»Ÿ JNI çš„å¯¹æ¯”</a></div></div></div></aside><main class="grow h-full overflow-auto w-3/4 px-8"><article class="text-zinc-200 mb-2 prose lg:prose-xl prose-stone
                 prose-headings:text-current prose-strong:text-current prose-code:text-current
                 prose-a:text-violet-200 prose-blockquote:text-stone-100"> <header> <h1>æ·±å…¥ç†è§£ Kotlin å†·æµ (Cold Flow)ï¼šå¼‚æ­¥æ•°æ®æµçš„åŸºç¡€</h1> </header> <h2 id="1-ä»€ä¹ˆæ˜¯å†·æµ">1. ä»€ä¹ˆæ˜¯å†·æµï¼Ÿ</h2>
<p>å†·æµ (Cold Flow) æ˜¯ Kotlin åç¨‹ Flow ä¸­æœ€åŸºç¡€ä¹Ÿæœ€é‡è¦çš„æ¦‚å¿µã€‚ç”¨ä¸€ä¸ªç”Ÿæ´»ä¸­çš„æ¯”å–»æ¥ç†è§£ï¼š</p>
<blockquote>
<p><strong>å†·æµå°±åƒè§†é¢‘å¹³å°ä¸Šçš„ç‚¹æ’­è§†é¢‘</strong></p>
<ul>
<li><strong>è¢«åŠ¨æ’­æ”¾</strong>ï¼šè§†é¢‘è™½ç„¶å­˜åœ¨äºæœåŠ¡å™¨ä¸Šï¼Œä½†ä¸ä¼šä¸»åŠ¨æ’­æ”¾ã€‚åªæœ‰å½“ç”¨æˆ·ç‚¹å‡» <strong>æ’­æ”¾ (<code>collect</code>)</strong> æ—¶ï¼Œè§†é¢‘æ‰ä¼šå¼€å§‹ä¼ è¾“ã€‚</li>
<li><strong>ç‹¬ç«‹è¿›åº¦</strong>ï¼šæ¯ä¸ªè§‚ä¼—éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„æ’­æ”¾è¿›åº¦ã€‚A çœ‹åˆ°ç¬¬ 5 åˆ†é’Ÿï¼ŒB å¯èƒ½åˆšå¼€å§‹çœ‹ï¼Œä»–ä»¬äº’ä¸å¹²æ‰°ã€‚</li>
</ul>
</blockquote>
<p>ä¸ä¹‹ç›¸å¯¹ï¼Œ<strong>çƒ­æµ (Hot Flow)</strong> å°±åƒç›´æ’­ï¼Œæ— è®ºæœ‰æ²¡æœ‰äººçœ‹ï¼Œéƒ½åœ¨æŒç»­æ’­æ”¾ï¼Œä¸”æ‰€æœ‰è§‚ä¼—çœ‹åˆ°çš„æ˜¯åŒä¸€ç”»é¢ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œå†·æµæ˜¯ <strong>æƒ°æ€§ (Lazy)</strong> çš„ã€‚è¿™æ„å‘³ç€åœ¨æ²¡æœ‰è®¢é˜…è€…è°ƒç”¨ <code>collect()</code> æ–¹æ³•ä¹‹å‰ï¼Œ<code>Flow</code> æ„å»ºå—å†…éƒ¨çš„ä»£ç  <strong>å®Œå…¨ä¸æ‰§è¡Œ</strong>ã€‚</p>
<hr>
<h2 id="2-æ ¸å¿ƒç‰¹æ€§">2. æ ¸å¿ƒç‰¹æ€§</h2>
<p>å†·æµå…·å¤‡ä»¥ä¸‹å››å¤§æ ¸å¿ƒç‰¹æ€§ï¼š</p>
<ol>
<li><strong>æƒ°æ€§æ‰§è¡Œ</strong>
åªæœ‰å½“ç»ˆç«¯æ“ä½œç¬¦ï¼ˆå¦‚ <code>collect</code>ï¼‰è¢«è°ƒç”¨æ—¶ï¼Œç”Ÿäº§è€…çš„ä»£ç æ‰ä¼šçœŸæ­£å¼€å§‹è¿è¡Œã€‚</li>
<li><strong>ç‹¬ç«‹å®ä¾‹</strong>
æ¯æ¬¡è°ƒç”¨ <code>collect()</code> éƒ½ä¼šè§¦å‘ <code>Flow</code> çš„ä¸€æ¬¡<strong>å®Œæ•´é‡æ–°æ‰§è¡Œ</strong>ã€‚æ¯ä¸ªè®¢é˜…è€…éƒ½ä¼šè·å¾—ä¸€ä¸ªå…¨æ–°çš„ã€ä»å¤´å¼€å§‹çš„æ•°æ®æµï¼Œå½¼æ­¤ä¹‹é—´æ²¡æœ‰ä»»ä½•å…³è”ã€‚</li>
<li><strong>æ— çŠ¶æ€</strong>
å†·æµæœ¬èº«ä¸æŒæœ‰çŠ¶æ€ï¼ˆå¦‚â€œå½“å‰æœ€æ–°çš„å€¼â€ï¼‰ã€‚å®ƒåªæ˜¯ä¸€ä¸ªå®šä¹‰äº†â€œå¦‚ä½•ç”Ÿäº§æ•°æ®â€çš„è“å›¾æˆ–å‘å°„å£ã€‚</li>
<li><strong>å“åº”å–æ¶ˆ</strong>
å†·æµä¸¥æ ¼éµå¾ªåç¨‹çš„ç»“æ„åŒ–å¹¶å‘åŸåˆ™ã€‚å½“æ”¶é›†æµçš„åç¨‹è¢«å–æ¶ˆæ—¶ï¼Œ<code>flow{...}</code> å†…éƒ¨çš„ç”Ÿäº§è€…ä»£ç ä¹Ÿä¼šè‡ªåŠ¨å–æ¶ˆã€‚è¿™èƒ½æœ‰æ•ˆé˜²æ­¢èµ„æºæ³„æ¼ï¼ˆå¦‚ç½‘ç»œè¯·æ±‚æˆ–æ•°æ®åº“è¿æ¥ä¼šåœ¨ç•Œé¢å…³é—­æ—¶è‡ªåŠ¨æ–­å¼€ï¼‰ã€‚</li>
</ol>
<h3 id="å…¸å‹ä»£è¡¨">å…¸å‹ä»£è¡¨</h3>
<ul>
<li>é€šè¿‡ <code>flow { ... }</code> æ„å»ºå™¨åˆ›å»ºçš„æµã€‚</li>
<li>é€šè¿‡ <code>flowOf(...)</code>, <code>.asFlow()</code> ç­‰å·¥å‚å‡½æ•°åˆ›å»ºçš„æµã€‚</li>
</ul>
<hr>
<h2 id="3-åŸºç¡€ç¤ºä¾‹ä¸åˆ†æ">3. åŸºç¡€ç¤ºä¾‹ä¸åˆ†æ</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="kotlin"><code><span class="line"><span style="color:#6A737D">// å®šä¹‰å†·æµï¼šä»…ä»…å®šä¹‰äº† "å¦‚ä½•" äº§ç”Ÿæ•°æ®</span></span>
<span class="line"><span style="color:#F97583">val</span><span style="color:#E1E4E8"> coldFlow </span><span style="color:#F97583">=</span><span style="color:#B392F0"> flow</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Flow å¼€å§‹æ‰§è¡Œ..."</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">// è¿™è¡Œä»£ç åªä¼šåœ¨ collect æ—¶è¢«è°ƒç”¨</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> (i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> 1</span><span style="color:#F97583">..</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#B392F0">        delay</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1000</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span>
<span class="line"><span style="color:#B392F0">        emit</span><span style="color:#E1E4E8">(i)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">fun</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">=</span><span style="color:#B392F0"> runBlocking</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"å³å°†å¼€å§‹æ”¶é›†..."</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // ç¬¬ä¸€ä¸ªè®¢é˜…è€…</span></span>
<span class="line"><span style="color:#B392F0">    launch</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"è®¢é˜…è€…1 å¼€å§‹æ”¶é›†"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        coldFlow.</span><span style="color:#B392F0">collect</span><span style="color:#E1E4E8"> { </span><span style="color:#F97583">value</span><span style="color:#F97583"> -></span></span>
<span class="line"><span style="color:#B392F0">            println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"è®¢é˜…è€…1 æ”¶åˆ°: </span><span style="color:#79B8FF">$value</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // å»¶è¿Ÿä¸€æ®µæ—¶é—´ï¼Œè®©ç¬¬ä¸€ä¸ªè®¢é˜…è€…å…ˆè¿è¡Œ</span></span>
<span class="line"><span style="color:#B392F0">    delay</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2500</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // ç¬¬äºŒä¸ªè®¢é˜…è€…</span></span>
<span class="line"><span style="color:#B392F0">    launch</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"è®¢é˜…è€…2 å¼€å§‹æ”¶é›†"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#6A737D">        // æ³¨æ„ï¼šè¿™é‡Œå†æ¬¡è°ƒç”¨ collectï¼Œä¼šè§¦å‘ Flow é‡æ–°æ‰§è¡Œ</span></span>
<span class="line"><span style="color:#E1E4E8">        coldFlow.</span><span style="color:#B392F0">collect</span><span style="color:#E1E4E8"> { </span><span style="color:#F97583">value</span><span style="color:#F97583"> -></span></span>
<span class="line"><span style="color:#B392F0">            println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"è®¢é˜…è€…2 æ”¶åˆ°: </span><span style="color:#79B8FF">$value</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="è¾“å‡ºç»“æœ">è¾“å‡ºç»“æœ</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="text"><code><span class="line"><span>å³å°†å¼€å§‹æ”¶é›†...</span></span>
<span class="line"><span>è®¢é˜…è€…1 å¼€å§‹æ”¶é›†</span></span>
<span class="line"><span>Flow å¼€å§‹æ‰§è¡Œ...</span></span>
<span class="line"><span>è®¢é˜…è€…1 æ”¶åˆ°: 1</span></span>
<span class="line"><span>è®¢é˜…è€…1 æ”¶åˆ°: 2</span></span>
<span class="line"><span>è®¢é˜…è€…2 å¼€å§‹æ”¶é›†</span></span>
<span class="line"><span>Flow å¼€å§‹æ‰§è¡Œ...  &#x3C;-- é‡ç‚¹ï¼šFlow ä¸ºè®¢é˜…è€…2é‡æ–°å¼€å§‹æ‰§è¡Œäº†</span></span>
<span class="line"><span>è®¢é˜…è€…1 æ”¶åˆ°: 3</span></span>
<span class="line"><span>è®¢é˜…è€…2 æ”¶åˆ°: 1</span></span>
<span class="line"><span>è®¢é˜…è€…2 æ”¶åˆ°: 2</span></span>
<span class="line"><span>è®¢é˜…è€…2 æ”¶åˆ°: 3</span></span></code></pre>
<p><strong>åˆ†æ</strong>ï¼šä»è¾“å‡ºå¯ä»¥çœ‹åˆ°ï¼Œ<code>Flow å¼€å§‹æ‰§è¡Œ...</code> è¢«æ‰“å°äº†ä¸¤æ¬¡ã€‚è¿™æ„å‘³ç€æ¯ä¸ª <code>collect</code> éƒ½è§¦å‘äº†ä¸€æ¬¡å…¨æ–°çš„ã€ç‹¬ç«‹çš„æ‰§è¡Œæµç¨‹ã€‚è®¢é˜…è€… 2 å¹¶æ²¡æœ‰â€œæ¥å…¥â€è®¢é˜…è€… 1 çš„è¿›åº¦ï¼Œè€Œæ˜¯ä»å¤´å¼€å§‹æ¥æ”¶æ•°æ®ã€‚</p>
<hr>
<h2 id="4-èƒŒå‹-backpressure-ä¸ç¼“å†²åŒº">4. èƒŒå‹ (Backpressure) ä¸ç¼“å†²åŒº</h2>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼Œå†·æµçš„ç”Ÿäº§é€Ÿåº¦æ˜¯ç”±æ¶ˆè´¹é€Ÿåº¦å†³å®šçš„ã€‚<code>emit</code> æ˜¯ä¸€ä¸ª <strong>æŒ‚èµ·å‡½æ•°</strong>ï¼Œå¦‚æœæ¶ˆè´¹è€…å¤„ç†å¾—æ…¢ï¼Œç”Ÿäº§è€…å°±ä¼šåœ¨ <code>emit</code> å¤„æŒ‚èµ·ç­‰å¾…ã€‚</p>
<h3 id="é»˜è®¤è¡Œä¸ºåŒæ­¥ç­‰å¾…">é»˜è®¤è¡Œä¸ºï¼šåŒæ­¥ç­‰å¾…</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="kotlin"><code><span class="line"><span style="color:#F97583">val</span><span style="color:#E1E4E8"> coldFlow </span><span style="color:#F97583">=</span><span style="color:#B392F0"> flow</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> (i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> 1</span><span style="color:#F97583">..</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#B392F0">        delay</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">100</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">// ç”Ÿäº§å¿«</span></span>
<span class="line"><span style="color:#B392F0">        emit</span><span style="color:#E1E4E8">(i)</span></span>
<span class="line"><span style="color:#B392F0">        println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"</span><span style="color:#79B8FF">$i</span><span style="color:#9ECBFF"> å‘é€ç»“æŸ"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">fun</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">(): </span><span style="color:#B392F0">Unit</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> runBlocking</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    launch</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">        coldFlow.</span><span style="color:#B392F0">collect</span><span style="color:#E1E4E8"> { </span><span style="color:#F97583">value</span><span style="color:#F97583"> -></span></span>
<span class="line"><span style="color:#B392F0">            delay</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1000L</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">// æ¶ˆè´¹æ…¢</span></span>
<span class="line"><span style="color:#B392F0">            println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"æ¶ˆè´¹: </span><span style="color:#79B8FF">$value</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>è¾“å‡ºï¼š</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="text"><code><span class="line"><span>æ¶ˆè´¹: 1</span></span>
<span class="line"><span>1 å‘é€ç»“æŸ</span></span>
<span class="line"><span>æ¶ˆè´¹: 2</span></span>
<span class="line"><span>2 å‘é€ç»“æŸ</span></span>
<span class="line"><span>...</span></span></code></pre>
<p><strong>ç»“è®º</strong>ï¼šæ•°æ®æ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ªæŒ‰éœ€ç”Ÿäº§å’Œæ¶ˆè´¹çš„ï¼Œä¸ä¼šåœ¨æµå†…éƒ¨ç§¯å‹ã€‚</p>
<h3 id="ä½¿ç”¨-buffer-ä¿®æ”¹è¡Œä¸º">ä½¿ç”¨ <code>.buffer()</code> ä¿®æ”¹è¡Œä¸º</h3>
<p>ä½¿ç”¨ <code>buffer()</code> æ“ä½œç¬¦å¯ä»¥å¹¶å‘åœ°è¿è¡Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼Œå¹¶åœ¨å®ƒä»¬ä¹‹é—´æ’å…¥ä¸€ä¸ªç¼“å†²åŒºï¼Œä»è€Œ<strong>ç ´å</strong>è¿™ç§åŒæ­¥ç­‰å¾…æœºåˆ¶ã€‚</p>
<h4 id="buffer-çš„å‚æ•°é…ç½®"><code>.buffer</code> çš„å‚æ•°é…ç½®</h4>
<ul>
<li><strong><code>capacity: Int</code></strong> (ç¼“å†²åŒºå¤§å°):
<ul>
<li><code>Channel.BUFFERED</code> (-2): é»˜è®¤å€¼ï¼Œé€šå¸¸ä¸º 64ã€‚</li>
<li><code>Channel.CONFLATED</code> (-1): ä»…ä¿ç•™æœ€æ–°å€¼ï¼Œç›¸å½“äºå®¹é‡ä¸º 1 ä¸”ç­–ç•¥ä¸º DROP_OLDESTã€‚</li>
<li><code>Channel.RENDEZVOUS</code> (0): æ— ç¼“å†²ã€‚</li>
<li><code>Channel.UNLIMITED</code> (Int.MAX_VALUE): æ— é™å®¹é‡ã€‚</li>
<li>æˆ–è€…å…¶ä»–æŒ‡å®šçš„å¤§å°ã€‚</li>
</ul>
</li>
<li><strong><code>onBufferOverflow: BufferOverflow</code></strong> (æº¢å‡ºç­–ç•¥):
<ul>
<li><code>SUSPEND</code> (é»˜è®¤): ç¼“å†²åŒºæ»¡æ—¶ï¼Œç”Ÿäº§è€…æŒ‚èµ·ã€‚</li>
<li><code>DROP_OLDEST</code>: ä¸¢å¼ƒç¼“å†²åŒºä¸­æœ€è€çš„æ•°æ®ï¼Œè…¾å‡ºç©ºé—´ç»™æ–°æ•°æ®ã€‚</li>
<li><code>DROP_LATEST</code>: ç›´æ¥ä¸¢å¼ƒå½“å‰å‡†å¤‡å‘é€çš„æ–°æ•°æ®ã€‚</li>
</ul>
</li>
</ul>
<h4 id="ç¼“å†²åŒºä»£ç ç¤ºä¾‹">ç¼“å†²åŒºä»£ç ç¤ºä¾‹</h4>
<p>ä½¿ç”¨å®¹é‡ä¸º 3 çš„ç¼“å†²åŒºï¼Œä¸”ç­–ç•¥ä¸ºâ€œä¸¢å¼ƒæ—§æ•°æ®â€ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="kotlin"><code><span class="line"><span style="color:#F97583">val</span><span style="color:#E1E4E8"> coldFlow </span><span style="color:#F97583">=</span><span style="color:#B392F0"> flow</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> (i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> 1</span><span style="color:#F97583">..</span><span style="color:#79B8FF">30</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#B392F0">        delay</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">100L</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">// 100ms ç”Ÿäº§ä¸€ä¸ª</span></span>
<span class="line"><span style="color:#B392F0">        emit</span><span style="color:#E1E4E8">(i)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">fun</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">(): </span><span style="color:#B392F0">Unit</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> runBlocking</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    launch</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">        // ç¼“å†²åŒºå®¹é‡ 3ï¼Œæº¢å‡ºæ—¶ä¸¢å¼ƒæœ€è€çš„æ•°æ®</span></span>
<span class="line"><span style="color:#E1E4E8">        coldFlow.</span><span style="color:#B392F0">buffer</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">3</span><span style="color:#E1E4E8">, BufferOverflow.DROP_OLDEST).</span><span style="color:#B392F0">collect</span><span style="color:#E1E4E8"> { </span><span style="color:#F97583">value</span><span style="color:#F97583"> -></span></span>
<span class="line"><span style="color:#B392F0">            delay</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">800L</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">// 800ms æ¶ˆè´¹ä¸€ä¸ª</span></span>
<span class="line"><span style="color:#B392F0">            println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"æ¶ˆè´¹: </span><span style="color:#79B8FF">$value</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>è¾“å‡ºç»“æœï¼š</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="text"><code><span class="line"><span>æ¶ˆè´¹: 1</span></span>
<span class="line"><span>æ¶ˆè´¹: 6</span></span>
<span class="line"><span>æ¶ˆè´¹: 13</span></span>
<span class="line"><span>æ¶ˆè´¹: 21</span></span>
<span class="line"><span>æ¶ˆè´¹: 28</span></span>
<span class="line"><span>æ¶ˆè´¹: 29</span></span>
<span class="line"><span>æ¶ˆè´¹: 30</span></span></code></pre>
<p><strong>ç»“æœåˆ†æ (Timeline)</strong>ï¼š</p>
<ol>
<li><strong>å¼€å§‹æ—¶</strong>ï¼šç”Ÿäº§è€…è¿…é€Ÿå‘å‡º <code>1, 2, 3, 4</code> å¡«æ»¡ç¼“å†²åŒºï¼ˆå®¹é‡ 3 + å†…éƒ¨æ§½ä½ï¼‰ã€‚æ¶ˆè´¹è€…å–èµ° <code>1</code> å¼€å§‹æ…¢é€Ÿå¤„ç†ã€‚</li>
<li><strong>æ¶ˆè´¹è€…å¤„ç†æœŸé—´</strong>ï¼šç”Ÿäº§è€…ç»§ç»­é£é€Ÿç”Ÿäº§ã€‚ç”±äºç¼“å†²åŒºå·²æ»¡ä¸”ç­–ç•¥æ˜¯ <code>DROP_OLDEST</code>ï¼Œç¼“å†²åŒºå†…è¾ƒè€çš„æ•°æ®ï¼ˆå¦‚ 2, 3, 4â€¦ï¼‰ä¸æ–­è¢«æ–°æ•°æ®æŒ¤å‡ºå¹¶ä¸¢å¼ƒã€‚</li>
<li><strong>æ¶ˆè´¹è€…å¤„ç†å®Œå</strong>ï¼šå½“æ¶ˆè´¹è€…ç»ˆäºå¤„ç†å®Œ <code>1</code> (800mså) å¹¶è¯·æ±‚ä¸‹ä¸€ä¸ªæ•°æ®æ—¶ï¼Œå®ƒæ‹¿åˆ°çš„æ˜¯å½“æ—¶ç¼“å†²åŒºé‡Œå¹¸å­˜ä¸‹æ¥çš„â€œæœ€è€â€çš„æ•°æ®ï¼ˆæ­¤æ—¶å·²ç»æ˜¯ <code>6</code> äº†ï¼‰ã€‚</li>
<li><strong>æœ€ç»ˆç°è±¡</strong>ï¼šæ¶ˆè´¹è€…æ‰“å°å‡ºçš„æ•°å­—ä¸è¿ç»­ï¼Œä¸¢å¤±äº†ä¸­é—´å¤§é‡çš„æ•°æ®ã€‚</li>
</ol>
<hr>
<h2 id="5-å†·æµ-vs-collectiont">5. å†·æµ vs <code>Collection&#x3C;T></code></h2>
<p>å†·æµä¸é›†åˆ (<code>List</code>, <code>Set</code>) éƒ½å¯ä»¥è¡¨ç¤ºä¸€ç³»åˆ—æ•°æ®ï¼Œä½†å®ƒä»¬åœ¨å¤„ç†æ—¶é—´ã€å†…å­˜å’Œå¤æ‚æ€§ä¸Šæœ‰æœ¬è´¨åŒºåˆ«ã€‚</p>






























<table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">Collection (List/Set)</th><th align="left">Cold Flow</th></tr></thead><tbody><tr><td align="left"><strong>æœ¬è´¨</strong></td><td align="left">æ•°æ®çš„<strong>å®¹å™¨</strong> (Storage)</td><td align="left">æ•°æ®çš„<strong>ç”Ÿäº§è€…</strong> (Producer)</td></tr><tr><td align="left"><strong>æ•°æ®å­˜åœ¨å½¢å¼</strong></td><td align="left">æ‰€æœ‰æ•°æ®å¿…é¡»<strong>åŒæ—¶</strong>å­˜åœ¨äºå†…å­˜ä¸­</td><td align="left">æ•°æ®<strong>é€ä¸ª</strong>ç”Ÿæˆå’Œå¤„ç†</td></tr><tr><td align="left"><strong>æ±‚å€¼ç­–ç•¥</strong></td><td align="left">åŠæ—©æ±‚å€¼</td><td align="left">æƒ°æ€§æ±‚å€¼</td></tr><tr><td align="left"><strong>å¼‚æ­¥æ”¯æŒ</strong></td><td align="left">å›°éš¾ (éœ€æ‰‹åŠ¨ç®¡ç†åç¨‹)</td><td align="left"><strong>åŸç”Ÿæ”¯æŒ</strong> (emit/collect æ˜¯æŒ‚èµ·çš„)</td></tr></tbody></table>
<h4 id="1-å¼‚æ­¥æ€§-asynchronicity">1. å¼‚æ­¥æ€§ (Asynchronicity)</h4>
<ul>
<li><strong>List</strong>: è·å– <code>list[i]</code> æ˜¯åŒæ­¥ç¬é—´å®Œæˆçš„ã€‚å¦‚æœéœ€è¦å¯¹åˆ—è¡¨å…ƒç´ è¿›è¡Œè€—æ—¶æ“ä½œï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ï¼‰ï¼Œéœ€è¦æ‰‹åŠ¨éå†å¹¶å¯åŠ¨åç¨‹ï¼Œä»£ç å¤æ‚ä¸”éš¾ä»¥ç»„åˆã€‚</li>
<li><strong>Flow</strong>: ä¸“ä¸ºå¼‚æ­¥è®¾è®¡ã€‚åœ¨ <code>flow</code> ä¸­å¯ä»¥ç›´æ¥è°ƒç”¨ <code>suspend</code> å‡½æ•°ã€‚Flow çš„ç®¡é“å¼æ“ä½œç¬¦ï¼ˆ<code>map</code>, <code>filter</code>ï¼‰å¤©ç„¶æ”¯æŒå¼‚æ­¥ï¼Œä¸”ä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹ã€‚</li>
</ul>
<h4 id="2-å†…å­˜æ•ˆç‡-memory-efficiency">2. å†…å­˜æ•ˆç‡ (Memory Efficiency)</h4>
<ul>
<li><strong>List</strong>: å¦‚æœè¦å¤„ç† 1GB çš„æ–‡ä»¶ï¼Œå¿…é¡»å…ˆåˆ†é… 1GB å†…å­˜å°†æ–‡ä»¶å…¨éƒ¨è¯»å…¥ã€‚å®¹æ˜“å¯¼è‡´ <code>OutOfMemoryError</code>ã€‚</li>
<li><strong>Flow</strong>: åƒæµæ°´çº¿ä¸€æ ·ï¼Œè¯»ä¸€è¡Œã€å¤„ç†ä¸€è¡Œã€æ‰”æ‰ä¸€è¡Œã€‚æ— è®ºæ–‡ä»¶å¤šå¤§ï¼Œå†…å­˜å ç”¨å§‹ç»ˆç»´æŒåœ¨å¤„ç†â€œå•è¡Œæ•°æ®â€çš„æ°´å¹³ï¼Œæåº¦èŠ‚çœå†…å­˜ã€‚</li>
</ul>
<h4 id="3-æƒ°æ€§è®¡ç®—-lazy-computation">3. æƒ°æ€§è®¡ç®— (Lazy Computation)</h4>
<ul>
<li><strong>List</strong>: é“¾å¼è°ƒç”¨ï¼ˆ<code>map</code>, <code>filter</code>ï¼‰ä¼šäº§ç”Ÿä¸­é—´é›†åˆã€‚ä¾‹å¦‚ <code>list.map{...}.filter{...}</code> ä¼šåˆ›å»ºä¸¤ä¸ªä¸´æ—¶çš„å®Œæ•´åˆ—è¡¨ï¼Œæµªè´¹è®¡ç®—èµ„æºå’Œå†…å­˜ã€‚</li>
<li><strong>Flow</strong>: åªæœ‰éœ€è¦ä¸‹ä¸€ä¸ªæ•°æ®æ—¶ï¼Œä¸Šæ¸¸æ‰ä¼šè®¡ç®—ã€‚
<ul>
<li><em>ç¤ºä¾‹</em>: <code>flow.map{...}.filter{...}.take(1).collect()</code></li>
<li>ä¸€æ—¦ <code>take(1)</code> æ‹¿åˆ°äº†å®ƒéœ€è¦çš„ 1 ä¸ªæ•°æ®ï¼Œå®ƒä¼šç«‹å³<strong>å–æ¶ˆ</strong>æ•´ä¸ªä¸Šæ¸¸æµã€‚å“ªæ€•æºæ•°æ®æœ‰ 100 ä¸‡æ¡ï¼Œåç»­çš„ 999_999 æ¡éƒ½ä¸ä¼šè¢«è®¡ç®—æˆ–è¯»å–ã€‚</li>
</ul>
</li>
</ul>
<hr>
<h2 id="6-åº”ç”¨åœºæ™¯ç¤ºä¾‹å¤„ç†å¤§å‹æ—¥å¿—æ–‡ä»¶">6. åº”ç”¨åœºæ™¯ç¤ºä¾‹ï¼šå¤„ç†å¤§å‹æ—¥å¿—æ–‡ä»¶</h2>
<p><strong>ä»»åŠ¡</strong>ï¼šåœ¨ä¸€ä¸ª 2GB çš„æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œæ‰¾å‡ºå‰ 5 ä¸ªåŒ…å« â€œFATAL_ERRORâ€ çš„è¡Œå¹¶è§£æã€‚</p>
<h3 id="-æ–¹å¼ä¸€ä½¿ç”¨-list-ä½æ•ˆ">âŒ æ–¹å¼ä¸€ï¼šä½¿ç”¨ List (ä½æ•ˆ)</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="kotlin"><code><span class="line"><span style="color:#F97583">fun</span><span style="color:#B392F0"> processLogsWithList</span><span style="color:#E1E4E8">(file: </span><span style="color:#B392F0">File</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">    // è¯•å›¾å°† 2GB æ–‡ä»¶ä¸€æ¬¡æ€§è¯»å…¥å†…å­˜ -> å¯èƒ½å¯¼è‡´ OOM å´©æºƒ</span></span>
<span class="line"><span style="color:#6A737D">    // å³ä½¿å†…å­˜è¶³å¤Ÿå¤§ï¼Œè¿™ä¹Ÿä¼šæ¶ˆè€—å¤§é‡æ—¶é—´å’Œç®—åŠ›åœ¨æ–°å»º String å¯¹è±¡å’Œ ArrayList çš„æ‰©å®¹ä¸Š</span></span>
<span class="line"><span style="color:#F97583">    val</span><span style="color:#E1E4E8"> allLines: </span><span style="color:#B392F0">List</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">String</span><span style="color:#E1E4E8">> </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> file.</span><span style="color:#B392F0">readLines</span><span style="color:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    val</span><span style="color:#E1E4E8"> errorLines </span><span style="color:#F97583">=</span><span style="color:#B392F0"> mutableListOf</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">String</span><span style="color:#E1E4E8">>()</span></span>
<span class="line"><span style="color:#F97583">    for</span><span style="color:#E1E4E8"> (line </span><span style="color:#F97583">in</span><span style="color:#E1E4E8"> allLines) {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (line.</span><span style="color:#B392F0">contains</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"FATAL_ERROR"</span><span style="color:#E1E4E8">)) {</span></span>
<span class="line"><span style="color:#6A737D">             // ... é€»è¾‘å¤„ç†</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#6A737D">    // åç»­ JVM GC ä¼šæ¶ˆè€—å¤§é‡èµ„æºå›æ”¶ 2GB çš„å†…å­˜</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="-æ–¹å¼äºŒä½¿ç”¨-flow-é«˜æ•ˆ">âœ… æ–¹å¼äºŒï¼šä½¿ç”¨ Flow (é«˜æ•ˆ)</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="kotlin"><code><span class="line"><span style="color:#F97583">fun</span><span style="color:#B392F0"> processLogsWithFlow</span><span style="color:#E1E4E8">(file: </span><span style="color:#B392F0">File</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=</span><span style="color:#B392F0"> runBlocking</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    file.</span><span style="color:#B392F0">bufferedReader</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">lineSequence</span><span style="color:#E1E4E8">().</span><span style="color:#B392F0">asFlow</span><span style="color:#E1E4E8">() </span><span style="color:#6A737D">// 1. è½¬æ¢ä¸ºæµï¼Œé›¶å†…å­˜è´Ÿæ‹…</span></span>
<span class="line"><span style="color:#E1E4E8">        .</span><span style="color:#B392F0">filter</span><span style="color:#E1E4E8"> { it.</span><span style="color:#B392F0">contains</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"FATAL_ERROR"</span><span style="color:#E1E4E8">) }    </span><span style="color:#6A737D">// 2. æŒ‰éœ€è¿‡æ»¤</span></span>
<span class="line"><span style="color:#E1E4E8">        .</span><span style="color:#B392F0">take</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5</span><span style="color:#E1E4E8">)                                  </span><span style="color:#6A737D">// 3. åªè¦å‰ 5 ä¸ª</span></span>
<span class="line"><span style="color:#E1E4E8">        .</span><span style="color:#B392F0">onEach</span><span style="color:#E1E4E8"> { line </span><span style="color:#F97583">-></span><span style="color:#B392F0"> parseAndReport</span><span style="color:#E1E4E8">(line) }  </span><span style="color:#6A737D">// 4. æ”¯æŒå¼‚æ­¥è§£æå‡½æ•°</span></span>
<span class="line"><span style="color:#E1E4E8">        .</span><span style="color:#B392F0">collect</span><span style="color:#E1E4E8">()                                </span><span style="color:#6A737D">// 5. å¯åŠ¨æµæ°´çº¿</span></span>
<span class="line"><span style="color:#6A737D">    // åªè¦æ”¶é›†æ»¡ 5 æ¡ï¼Œæ–‡ä»¶è¯»å–ä¼šè‡ªåŠ¨åœæ­¢ï¼Œå“ªæ€•æ–‡ä»¶åé¢è¿˜æœ‰ 1GB å†…å®¹</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">suspend</span><span style="color:#F97583"> fun</span><span style="color:#B392F0"> parseAndReport</span><span style="color:#E1E4E8">(logLine: </span><span style="color:#B392F0">String</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#B392F0">    delay</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">100</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">// æ¨¡æ‹Ÿç½‘ç»œä¸ŠæŠ¥</span></span>
<span class="line"><span style="color:#B392F0">    println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Reported: </span><span style="color:#79B8FF">$logLine</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre> </article><div class="tags"><div class="_tailmateTag_u5zwa_5"><a href="/blog/tag/Kotlin/">Kotlin</a></div><div class="_tailmateTag_u5zwa_5"><a href="/blog/tag/Kotlin åç¨‹/">Kotlin åç¨‹</a></div><div class="_tailmateTag_u5zwa_5"><a href="/blog/tag/å¼‚æ­¥ç¼–ç¨‹/">å¼‚æ­¥ç¼–ç¨‹</a></div><div class="_tailmateTag_u5zwa_5"><a href="/blog/tag/æ€§èƒ½ä¼˜åŒ–/">æ€§èƒ½ä¼˜åŒ–</a></div><div class="_tailmateTag_u5zwa_5"><a href="/blog/tag/å†…å­˜ç®¡ç†/">å†…å­˜ç®¡ç†</a></div><div class="_tailmateTag_u5zwa_5"><a href="/blog/tag/å“åº”å¼ç¼–ç¨‹/">å“åº”å¼ç¼–ç¨‹</a></div><div class="_tailmateTag_u5zwa_5"><a href="/blog/tag/è½¯ä»¶æ¶æ„/">è½¯ä»¶æ¶æ„</a></div><div class="_tailmateTag_u5zwa_5"><a href="/blog/tag/JVM/">JVM</a></div></div></main></div><div class="okTgGW_footer"> <p>Supported and developed by&nbsp;
<a href="https://github.com/misakamayako/" target="_blank" rel="noreferrer">misaka mayako</a> </p> <p>
Tech with <a href="https://astro.build/" target="_blank" rel="noreferrer">astro</a>,&nbsp;
<a href="https://tailwindcss.com/" target="_blank" rel="noreferrer">tailwindcss</a>,&nbsp;
        and <a href="https://pm2.keymetrics.io/" target="_blank" rel="noreferrer">pm2</a>,&nbsp;
</p> <p> feed back via <a href="mailto:misakamayaco@qq.com" target="_blank" rel="noreferrer">ğŸ“«</a></p> <a rel="license noreferrer" href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" class="absolute right-6 bottom-6"> <img alt="çŸ¥è¯†å…±äº«è®¸å¯åè®®" class="inlin-block border-0" src="/cc4.0.png"> </a> </div></div><script type="module" is:global>
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('pre').forEach((block) => {
                if (block.dataset.language === 'plaintext') return
                const button = document.createElement('button')
                button.innerText = 'å¤åˆ¶'
                button.className =
                    'absolute top-2 right-2 bg-slate-800 text-white px-2 py-1 rounded text-sm opacity-50 hover:opacity-100 transition cursor-pointer'
                button.addEventListener('click', () => {
                    const code = block.querySelector('code')
                    if (code) {
                        navigator.clipboard.writeText(code.innerText).then(() => {
                            button.innerText = 'å·²å¤åˆ¶ï¼'
                            setTimeout(() => (button.innerText = 'å¤åˆ¶'), 1000)
                        })
                    }
                })
                block.classList.add('relative')
                block.appendChild(button)
            })
        })
    </script> </body></html>