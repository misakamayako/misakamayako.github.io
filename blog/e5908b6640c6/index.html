<!DOCTYPE html><html lang="zh-hans" class="h-full w-full m-0"> <head><meta charset="utf-8"><link rel="icon" type="image/jepg" href="/favicon.jpg"><meta name="viewport" content="width=device-width"><meta name="google-site-verification" content="-RgOsAO7rMTpJ8vNk8-ILdAA8VmiTEUc9HiUVVTKeEs"><meta name="generator" content="Astro v5.16.9"><title>âœ¨å¾¡å‚ç½‘ç»œ-ç²¾é€š Kotlin çƒ­æµ (Hot Flow)ï¼šStateFlow ä¸ SharedFlow å®æˆ˜æŒ‡å—âœ¨</title><link rel="stylesheet" href="/_astro/index.BT8t14_1.css">
<style>/*! tailwindcss v4.1.18 | MIT License | https://tailwindcss.com */
@layer properties{@supports (((-webkit-hyphens:none)) and (not (margin-trim:inline))) or ((-moz-orient:inline) and (not (color:rgb(from red r g b)))){*,:before,:after,::backdrop{--tw-border-style:solid}}}.okTgGW_footer{font-size:var(--text-sm,.875rem);line-height:var(--tw-leading,var(--text-sm--line-height,calc(1.25/.875)));color:var(--color-stone-400,#a6a09b);text-align:center;padding-block:calc(var(--spacing,.25rem)*4);border-top-color:var(--color-zinc-50,#fafafa);border-top-style:var(--tw-border-style);background-color:var(--color-slate-900,#0f172b);border-top-width:2px;width:100%;position:relative}@supports (color:color(display-p3 0 0 0)){.okTgGW_footer{color:var(--color-stone-400,color(display-p3 .647628 .627105 .61098));border-top-color:var(--color-zinc-50,color(display-p3 .980256 .980256 .980256));background-color:var(--color-slate-900,color(display-p3 .0639692 .0891152 .163036))}}@supports (color:lab(0% 0 0)){.okTgGW_footer{color:var(--color-stone-400,lab(66.2166% 1.88047 3.20326));border-top-color:var(--color-zinc-50,lab(98.26% -.0000298023 0));background-color:var(--color-slate-900,lab(7.78673% 1.82345 -15.0537))}}.okTgGW_footer a{text-decoration-line:underline}@property --tw-border-style{syntax:"*";inherits:false;initial-value:solid}
/*! tailwindcss v4.1.18 | MIT License | https://tailwindcss.com */
@layer properties{@supports (((-webkit-hyphens:none)) and (not (margin-trim:inline))) or ((-moz-orient:inline) and (not (color:rgb(from red r g b)))){*,:before,:after,::backdrop{--tw-border-style:solid;--tw-translate-x:0;--tw-translate-y:0;--tw-translate-z:0}}}.q0UmqG_menu{height:calc(var(--spacing,.25rem)*16);padding-right:calc(var(--spacing,.25rem)*16);border-bottom-color:var(--color-zinc-50,#fafafa);border-bottom-style:var(--tw-border-style);text-align:right;border-bottom-width:2px}@supports (color:color(display-p3 0 0 0)){.q0UmqG_menu{border-bottom-color:var(--color-zinc-50,color(display-p3 .980256 .980256 .980256))}}@supports (color:lab(0% 0 0)){.q0UmqG_menu{border-bottom-color:var(--color-zinc-50,lab(98.26% -.0000298023 0))}}.q0UmqG_menu a{padding-inline:calc(var(--spacing,.25rem)*2);padding-block:calc(var(--spacing,.25rem)*2);font-size:var(--text-xl,1.25rem);line-height:var(--tw-leading,var(--text-xl--line-height,calc(1.75/1.25)));color:var(--color-zinc-50,#fafafa);margin-top:calc(var(--spacing,.25rem)*2.5);display:inline-block}@supports (color:color(display-p3 0 0 0)){.q0UmqG_menu a{color:var(--color-zinc-50,color(display-p3 .980256 .980256 .980256))}}@supports (color:lab(0% 0 0)){.q0UmqG_menu a{color:var(--color-zinc-50,lab(98.26% -.0000298023 0))}}@media (hover:hover){.q0UmqG_menu a:hover{--tw-translate-y:calc(var(--spacing,.25rem)*-.5);translate:var(--tw-translate-x)var(--tw-translate-y);color:var(--color-sky-500,#00a5ef)}@supports (color:color(display-p3 0 0 0)){.q0UmqG_menu a:hover{color:var(--color-sky-500,color(display-p3 .219113 .639027 .931479))}}@supports (color:lab(0% 0 0)){.q0UmqG_menu a:hover{color:var(--color-sky-500,lab(63.3038% -18.433 -51.0407))}}}.q0UmqG_menu a{transition-property:transform,translate,scale,rotate;transition-timing-function:var(--tw-ease,var(--default-transition-timing-function,cubic-bezier(.4,0,.2,1)));transition-duration:var(--tw-duration,var(--default-transition-duration,.15s))}.q0UmqG_navLink{padding-inline:calc(var(--spacing,.25rem)*2);padding-block:calc(var(--spacing,.25rem)*2);font-size:var(--text-xl,1.25rem);line-height:var(--tw-leading,var(--text-xl--line-height,calc(1.75/1.25)));color:var(--color-zinc-50,#fafafa);margin-top:calc(var(--spacing,.25rem)*2.5);display:inline-block}@supports (color:color(display-p3 0 0 0)){.q0UmqG_navLink{color:var(--color-zinc-50,color(display-p3 .980256 .980256 .980256))}}@supports (color:lab(0% 0 0)){.q0UmqG_navLink{color:var(--color-zinc-50,lab(98.26% -.0000298023 0))}}@media (hover:hover){.q0UmqG_navLink:hover{color:var(--color-sky-500,#00a5ef)}@supports (color:color(display-p3 0 0 0)){.q0UmqG_navLink:hover{color:var(--color-sky-500,color(display-p3 .219113 .639027 .931479))}}@supports (color:lab(0% 0 0)){.q0UmqG_navLink:hover{color:var(--color-sky-500,lab(63.3038% -18.433 -51.0407))}}}.q0UmqG_navLink{transition:color .4s}.q0UmqG_avatar{float:right;border-radius:.25rem;display:inline-block;overflow:hidden}@property --tw-border-style{syntax:"*";inherits:false;initial-value:solid}@property --tw-translate-x{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-y{syntax:"*";inherits:false;initial-value:0}@property --tw-translate-z{syntax:"*";inherits:false;initial-value:0}
</style>
<link rel="stylesheet" href="/_astro/_slug_.BOOrbLic.css"><script type="module" src="/_astro/page.D1uwR3nK.js"></script></head> <body class="w-full h-full flex flex-col">  <div class="bg-slate-800 h-screen flex flex-col"> <div class="bg-slate-700 w-full"> <div class="q0UmqG_avatar"> <img src="/favicon.jpg" width="64" height="64" alt=""> </div> <nav class="q0UmqG_menu"> <a href="/" class="q0UmqG_navLink">home</a> <a href="/blog/" class="q0UmqG_navLink">blog</a> <a href="/utils/" class="q0UmqG_navLink">utils</a> <a href="/dream-map/" class="inline-block">dream map</a> <a href="/album/" class="q0UmqG_navLink">album</a> <a href="/about-me/" class="q0UmqG_navLink">about me</a> </nav> </div> <div class="flex p-4 grow flex-row h-full overflow-hidden"> <aside class="w-1/4 ml-4 md:block min-w-[200px] overflow-auto"> <div class="sticky top-4 space-y-6"> <div class="bg-slate-700 p-4 rounded-lg"> <img src="/avatar.jpg" class="w-16 h-16 rounded-full mx-auto"> <p class="text-white text-center mt-2">ä½œè€…ï¼šmisakamayako</p>  <p class="text-white text-center mt-2">å‘å¸ƒæ—¶é—´ï¼š2025/11/17</p> </div> <div class="bg-slate-700 p-4 rounded-lg"> <h3 class="text-emerald-400 mb-2">ç®€ä»‹</h3> <p class="text-white font-light mb-2">æœ¬æ–‡æ˜¯ Kotlin åç¨‹çƒ­æµ (Hot Flow) çš„å®ç”¨æŒ‡å—ã€‚é€šè¿‡æ¸…æ™°çš„ç¤ºä¾‹ï¼Œè®²è§£äº† StateFlow å’Œ SharedFlow å¦‚ä½•åœ¨ Android/KMP é¡¹ç›®ä¸­é«˜æ•ˆç®¡ç† UI çŠ¶æ€å’Œå¤„ç†ä¸€æ¬¡æ€§äº‹ä»¶é€šçŸ¥ï¼Œå¹¶ä»‹ç»äº† stateIn/shareIn è¿™ä¸¤ä¸ªå…³é”®æ“ä½œç¬¦çš„æœ€ä½³ç”¨æ³•ã€‚</p> </div> <!-- 2. æ–‡ç« ç›®å½• --> <!--<div class="bg-slate-700 p-4 rounded-lg">--> <!--    <h3 class="text-emerald-400 mb-2">æœ¬æ–‡ç›®å½•</h3>--> <!--    &lt;!&ndash;<TOC client:load /> &ndash;&gt;--> <!--</div>--> <!-- 3. éšæœºæ–‡ç«  --> <div class="bg-slate-700 p-4 rounded-lg"> <h3 class="text-emerald-400 mb-2">éšä¾¿çœ‹çœ‹</h3> <div class="flex flex-wrap gap-2"> <a class="px-3 py-1 bg-slate-600 rounded-full text-sm text-white hover:bg-emerald-500 transition" href="/blog/eebfd4c2dd11/"> Sass ä¸ Lessï¼šå“ªç§ CSS é¢„å¤„ç†å™¨æ›´é€‚åˆä½ ï¼Ÿ </a><a class="px-3 py-1 bg-slate-600 rounded-full text-sm text-white hover:bg-emerald-500 transition" href="/blog/cb3ac2e417a0/"> Java VarHandle ä¸ Reflection çš„å¯¹æ¯”åŠæ€§èƒ½æµ‹è¯• </a><a class="px-3 py-1 bg-slate-600 rounded-full text-sm text-white hover:bg-emerald-500 transition" href="/blog/18b5a9299ef3/"> Kotlin å¼•ç”¨æ“ä½œç¬¦(::)çš„ä½¿ç”¨ </a> </div> </div> </div> </aside> <main class="grow h-full overflow-auto w-3/4 px-8"> <article class="text-zinc-200 mb-2 prose lg:prose-xl prose-stone
                 prose-headings:text-current prose-strong:text-current prose-code:text-current
                 prose-a:text-violet-200 prose-blockquote:text-stone-100">  <header> <h1>ç²¾é€š Kotlin çƒ­æµ (Hot Flow)ï¼šStateFlow ä¸ SharedFlow å®æˆ˜æŒ‡å—</h1> </header> <h2 id="1-ä»€ä¹ˆæ˜¯çƒ­æµ">1. ä»€ä¹ˆæ˜¯çƒ­æµï¼Ÿ</h2>
<p>çƒ­æµ (Hot Flow) æ˜¯ Kotlin åç¨‹ Flow ä¸­çš„é‡è¦æ¦‚å¿µã€‚ç”¨ä¸€ä¸ªç”Ÿæ´»ä¸­çš„æ¯”å–»æ¥ç†è§£ï¼š</p>
<blockquote>
<p><strong>çƒ­æµå°±åƒç›´æ’­å¹³å°ä¸Šçš„ç›´æ’­æµè§†é¢‘</strong></p>
<ul>
<li><strong>ä¸»åŠ¨æ’­æ”¾</strong>ï¼šè§†é¢‘ä¸€æ—¦åˆ›å»ºå°±ä¼šä¸»åŠ¨æ’­æ”¾ï¼Œæ— è®ºæ˜¯å¦æœ‰äººè®¢é˜…ã€‚</li>
<li><strong>å…±äº«è¿›åº¦</strong>ï¼šæ¯ä¸ªè§‚ä¼—çš„æ’­æ”¾è¿›åº¦éƒ½æ˜¯ç›¸åŒçš„ã€‚A ä»ç¬¬ 5 åˆ†é’Ÿå¼€å§‹çœ‹ï¼Œ30 åˆ†é’Ÿå B å†å¼€å§‹çœ‹ï¼Œä»–ä»¬çœ‹åˆ°çš„ç”»é¢éƒ½æ˜¯ä¸€æ ·çš„ã€‚</li>
</ul>
</blockquote>
<p>ç®€å•æ¥è¯´ï¼Œ<strong>çƒ­æµ</strong> ä¸€æ—¦å¼€å§‹å‘å°„ï¼Œå°±ä¸ä¼šå› ä¸ºè®¢é˜…è€…çš„åŠ å…¥æˆ–ç¦»å¼€è€Œæ”¹å˜è‡ªå·±çš„â€œæ—¶é—´çº¿â€ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå®ƒä¸ä¼šç­‰å¾…è®¢é˜…è€…ï¼Œä¹Ÿä¸ä¼šå€’å¸¦ã€‚
æ­¤å¤–ï¼Œä¸å†·æµä¸åŒçš„æ˜¯ï¼Œ<code>SharedFlow</code> ä¸ <code>StateFlow</code> å¹¶ä¸ä¼šè‡ªåŠ¨äº§ç”Ÿæ•°æ®ã€‚å®ƒä»¬åªæ˜¯æ‰¿è½½æ•°æ®ï¼ŒçœŸæ­£çš„æ¥æºå§‹ç»ˆæ˜¯å‘å°„å®ƒä»¬çš„ç”Ÿäº§è€…ï¼ˆemitï¼‰ã€‚</p>
<hr>
<h2 id="2-æ ¸å¿ƒç‰¹æ€§">2. æ ¸å¿ƒç‰¹æ€§</h2>
<ol>
<li><strong>ä¸»åŠ¨æ‰§è¡Œ</strong>
çƒ­æµä¸€æ—¦åˆ›å»ºä¾¿å¼€å§‹å‘å°„æ•°æ®ï¼Œæ— éœ€ç­‰å¾…è®¢é˜…è€…çš„è®¢é˜…æ“ä½œã€‚</li>
<li><strong>å…±äº«å®ä¾‹</strong>
å¤šä¸ªè®¢é˜…è€…å…±äº«åŒä¸€ä¸ªæ•°æ®æµå®ä¾‹ï¼Œè®¢é˜…è€…æ¥æ”¶åˆ°çš„æ˜¯çƒ­æµå½“å‰çš„æœ€æ–°æ•°æ®ï¼Œä¸ä¼šä»å¤´å¼€å§‹é‡æ”¾ã€‚</li>
<li><strong>æœ‰çŠ¶æ€</strong>
çƒ­æµé€šå¯ä»¥ä¿å­˜æœ€æ–°çš„æ•°æ®çŠ¶æ€ï¼ˆå¦‚ <code>StateFlow</code> æŒæœ‰å½“å‰çŠ¶æ€ï¼‰ï¼Œæ–¹ä¾¿æ–°è®¢é˜…è€…ç«‹å³è·å¾—å½“å‰å€¼ã€‚</li>
<li><strong>æŒç»­å‘å°„</strong>
çƒ­æµä¸ä¼šå› ä¸ºæŸä¸ªè®¢é˜…è€…å–æ¶ˆè€Œåœæ­¢å‘å°„æ•°æ®ï¼Œé€šå¸¸ç‹¬ç«‹äºè®¢é˜…è€…ç”Ÿå‘½å‘¨æœŸæŒç»­è¿è¡Œï¼Œé™¤éæ˜¾å¼åœæ­¢ã€‚</li>
</ol>
<h3 id="å…¸å‹ä»£è¡¨">å…¸å‹ä»£è¡¨</h3>
<ul>
<li>é€šè¿‡ <code>SharedFlow</code> æˆ–è€… <code>StateFlow</code> çš„æ„å»ºå™¨åˆ›å»ºçš„æµã€‚</li>
<li>é€šè¿‡ <code>shareIn</code> æˆ–è€… <code>stateIn</code> å°†ä¸€ä¸ªå†·æµè½¬æ¢ä¸ºçƒ­æµã€‚</li>
</ul>
<h3 id="stateflow-vs-sharedflowçŠ¶æ€-vs-äº‹ä»¶">StateFlow vs. SharedFlowï¼šçŠ¶æ€ vs. äº‹ä»¶</h3>
<p>å¦‚æœè¯´çƒ­æµæ˜¯â€œç›´æ’­â€ï¼Œé‚£ä¹ˆï¼š</p>
<ul>
<li><code>SharedFlow</code> å°±æ˜¯ç›´æ’­æœ¬èº«ï¼šå®ƒæŒç»­ä¸æ–­åœ°å¹¿æ’­äº‹ä»¶ã€‚ä½ ä¸­é€”åŠ å…¥ï¼Œåªèƒ½çœ‹åˆ°åŠ å…¥åçš„æ–°å†…å®¹ï¼ˆé™¤éé…ç½®äº† replay ç¼“å­˜ï¼‰ã€‚å®ƒéå¸¸é€‚åˆå‘é€â€œé˜…åå³ç„šâ€çš„é€šçŸ¥ï¼Œå¦‚ <code>Toast</code> æˆ–å¯¼èˆªäº‹ä»¶ã€‚</li>
<li><code>StateFlow</code> å°±åƒæ˜¯ç›´æ’­é—´é¡¶éƒ¨çš„â€œå½“å‰æ¯”åˆ†â€æˆ–â€œä¸»æ’­çŠ¶æ€â€å…¬å‘Šç‰Œï¼šå®ƒæ°¸è¿œåªæ˜¾ç¤ºæœ€æ–°çš„çŠ¶æ€ã€‚ä½ ä»»ä½•æ—¶å€™è¿›å…¥ç›´æ’­é—´ï¼Œçœ‹åˆ°çš„æ¯”åˆ†éƒ½æ˜¯æœ€æ–°çš„ã€‚æ–°è®¢é˜…è€…ä¼šç«‹å³æ”¶åˆ°å½“å‰å€¼ã€‚å› æ­¤ï¼Œå®ƒå¤©ç”Ÿå°±æ˜¯ç”¨æ¥ç®¡ç† UI çŠ¶æ€çš„ã€‚</li>
</ul>
<p>å¦å¤–ï¼Œä¸€ä¸ªç‰¹åˆ«çš„ç‚¹æ˜¯ï¼š<code>StateFlow</code> æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªé…ç½®ä¸º <code>replay = 1</code>ã€<code>onBufferOverflow = DROP_OLDEST</code> ä¸”è¡Œä¸ºç‰¹æ®Šçš„ <code>SharedFlow</code>ã€‚</p>
<hr>
<h2 id="3-åŸºç¡€ç¤ºä¾‹ä¸åˆ†æ">3. åŸºç¡€ç¤ºä¾‹ä¸åˆ†æ</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="kotlin"><code><span class="line"><span style="color:#F97583">fun</span><span style="color:#B392F0"> main</span><span style="color:#E1E4E8">(): </span><span style="color:#B392F0">Unit</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> runBlocking</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    // 1. åˆ›å»ºä¸€ä¸ª MutableSharedFlow</span></span>
<span class="line"><span style="color:#6A737D">    // è¿™æ˜¯ä¸€ä¸ªå¯å˜çš„ SharedFlowï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒæ¥å‘å°„ (emit) å€¼ã€‚</span></span>
<span class="line"><span style="color:#6A737D">    // é»˜è®¤æƒ…å†µä¸‹ï¼Œæ–°è®¢é˜…è€…ä¸ä¼šæ”¶åˆ°ä»»ä½•å†å²å€¼ (replay = 0)ã€‚</span></span>
<span class="line"><span style="color:#F97583">    val</span><span style="color:#E1E4E8"> sharedFlow </span><span style="color:#F97583">=</span><span style="color:#B392F0"> MutableSharedFlow</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">Int</span><span style="color:#E1E4E8">>()</span></span>
<span class="line"><span style="color:#6A737D">    // å¯åŠ¨ä¸€ä¸ªåç¨‹ä½œä¸ºå‘å°„å™¨ (Emitter)</span></span>
<span class="line"><span style="color:#B392F0">    launch</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"å‘å°„å™¨å·²å¯åŠ¨"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#B392F0">        delay</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1L</span><span style="color:#E1E4E8">)</span><span style="color:#6A737D">// çŸ­æš‚è®©å‡ºCPUï¼Œè®©å…¶ä»–åç¨‹æœ‰å¯åŠ¨å’Œæ‰§è¡Œçš„æœºä¼š</span></span>
<span class="line"><span style="color:#6A737D">        // æˆ–è€…ä½¿ç”¨è¿™ä¸ªæŒ‚èµ·ï¼Œç­‰å¾…è‡³å°‘æœ‰ä¸€ä¸ªè®¢é˜…è€… sharedFlow.subscriptionCount.first { count -> count > 0 }</span></span>
<span class="line"><span style="color:#F97583">        for</span><span style="color:#E1E4E8"> (i </span><span style="color:#F97583">in</span><span style="color:#79B8FF"> 1</span><span style="color:#F97583">..</span><span style="color:#79B8FF">4</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#B392F0">            println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"å‘å°„æ•°æ®: </span><span style="color:#79B8FF">$i</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">            sharedFlow.</span><span style="color:#B392F0">emit</span><span style="color:#E1E4E8">(i)</span></span>
<span class="line"><span style="color:#B392F0">            delay</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1000</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">// æ¯ç§’å‘å°„ä¸€ä¸ª</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#6A737D">        // SharedFlow ä¸ä¼šåƒæ™®é€š Flow é‚£æ ·å› ä¸ºä¸Šæ¸¸ç»“æŸè€Œç»“æŸã€‚</span></span>
<span class="line"><span style="color:#6A737D">        // é™¤éä½ åœæ­¢å‘å°„å®ƒï¼ˆå–æ¶ˆå‘å°„å™¨åç¨‹ï¼‰ï¼Œå¦åˆ™å®ƒä¼šä¸€ç›´ä¿æŒæ´»è·ƒã€‚</span></span>
<span class="line"><span style="color:#B392F0">        cancel</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // å¯åŠ¨ç¬¬ä¸€ä¸ªè®¢é˜…è€… (Collector 1)</span></span>
<span class="line"><span style="color:#B392F0">    launch</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"è®¢é˜…è€…1 å·²å¯åŠ¨"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        sharedFlow.</span><span style="color:#B392F0">collect</span><span style="color:#E1E4E8"> { </span><span style="color:#F97583">value</span><span style="color:#F97583"> -></span></span>
<span class="line"><span style="color:#B392F0">            println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"--- è®¢é˜…è€…1 æ”¶åˆ°: </span><span style="color:#79B8FF">$value</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // å»¶è¿Ÿ 1.5 ç§’ï¼Œè®©å‘å°„å™¨å…ˆå‘å°„ä¸€äº›æ•°æ®</span></span>
<span class="line"><span style="color:#B392F0">    delay</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1500</span><span style="color:#E1E4E8">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // å¯åŠ¨ç¬¬äºŒä¸ªè®¢é˜…è€… (Collector 2)ï¼Œå®ƒä¼šåŠ å…¥å¾—æ¯”è¾ƒæ™š</span></span>
<span class="line"><span style="color:#B392F0">    launch</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"è®¢é˜…è€…2 å·²å¯åŠ¨"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        sharedFlow.</span><span style="color:#B392F0">collect</span><span style="color:#E1E4E8"> { </span><span style="color:#F97583">value</span><span style="color:#F97583"> -></span></span>
<span class="line"><span style="color:#B392F0">            println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"------ è®¢é˜…è€…2 æ”¶åˆ°: </span><span style="color:#79B8FF">$value</span><span style="color:#9ECBFF">"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="è¾“å‡ºç»“æœ">è¾“å‡ºç»“æœ</h3>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>å‘å°„å™¨å·²å¯åŠ¨</span></span>
<span class="line"><span>è®¢é˜…è€…1 å·²å¯åŠ¨</span></span>
<span class="line"><span>å‘å°„æ•°æ®: 1</span></span>
<span class="line"><span>--- è®¢é˜…è€…1 æ”¶åˆ°: 1</span></span>
<span class="line"><span>å‘å°„æ•°æ®: 2</span></span>
<span class="line"><span>--- è®¢é˜…è€…1 æ”¶åˆ°: 2</span></span>
<span class="line"><span>è®¢é˜…è€…2 å·²å¯åŠ¨</span></span>
<span class="line"><span>å‘å°„æ•°æ®: 3</span></span>
<span class="line"><span>--- è®¢é˜…è€…1 æ”¶åˆ°: 3</span></span>
<span class="line"><span>------ è®¢é˜…è€…2 æ”¶åˆ°: 3</span></span>
<span class="line"><span>å‘å°„æ•°æ®: 4</span></span>
<span class="line"><span>--- è®¢é˜…è€…1 æ”¶åˆ°: 4</span></span>
<span class="line"><span>------ è®¢é˜…è€…2 æ”¶åˆ°: 4</span></span></code></pre>
<p><strong>åˆ†æ</strong>ï¼š</p>
<ul>
<li><strong>è®¢é˜…è€…1</strong> å‡ ä¹æ˜¯ç«‹å³å¼€å§‹è®¢é˜…çš„ï¼Œæ‰€ä»¥å®ƒä»ç¬¬ä¸€ä¸ªå€¼ <code>1</code> å¼€å§‹ï¼Œæ”¶åˆ°äº†æ‰€æœ‰å‘å°„çš„æ•°æ®ã€‚</li>
<li><strong>è®¢é˜…è€…2</strong> åœ¨ç¨‹åºå¯åŠ¨å 2.5ç§’ æ‰å¼€å§‹è®¢é˜…ã€‚åœ¨è¿™æ®µæ—¶é—´é‡Œï¼Œæ•°æ® 1 å’Œ 2 å·²ç»è¢«å‘å°„å‡ºå»äº†ã€‚</li>
<li>å› æ­¤ï¼Œè®¢é˜…è€…2 é”™è¿‡äº† 1 å’Œ 2ï¼Œå®ƒæ”¶åˆ°çš„ç¬¬ä¸€ä¸ªå€¼æ˜¯ 3ï¼Œä¹Ÿå°±æ˜¯å®ƒå¼€å§‹è®¢é˜…å sharedFlow å‘å°„çš„ç¬¬ä¸€ä¸ªå€¼ã€‚</li>
<li>ä»å€¼ 3 å¼€å§‹ï¼Œä¸¤ä¸ªè®¢é˜…è€…éƒ½ä¼šåŒæ—¶æ”¶åˆ°æ‰€æœ‰åç»­çš„æ•°æ®ï¼ˆ3, 4ï¼‰ã€‚</li>
</ul>
<p>å¦å¤–éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œ<code>MutableSharedFlow</code> æ˜¯ä¸€ä¸ªå¯é«˜åº¦é…ç½®çš„æ„é€ å™¨ï¼Œä½¿å¾—å®ƒå¯ä»¥æ»¡è¶³å„ç§å¸¸è§çš„åº”ç”¨åœºæ™¯ï¼š</p>
<ol>
<li>
<p><strong>replay: Int</strong>ï¼šç¼“å­˜å¹¶å‘æ–°è®¢é˜…è€…é‡æ”¾çš„æœ€æ–°å€¼çš„æ•°é‡ã€‚é»˜è®¤æ˜¯ 0ï¼Œå³ä¸é‡æ”¾ã€‚å¦‚æœè®¾ä¸º 10ï¼Œæ–°è®¢é˜…è€…ä¼šç«‹åˆ»æ”¶åˆ°æœ€è¿‘çš„ 10 æ¡æ¶ˆæ¯ã€‚StateFlow å°±å¯ä»¥çœ‹ä½œæ˜¯ replay = 1 çš„ç‰¹æ®Š SharedFlowã€‚</p>
</li>
<li>
<p><strong>extraBufferCapacity: Int</strong>ï¼šé™¤ <code>replay</code> ç¼“å­˜å¤–ï¼Œé¢å¤–æä¾›çš„ç¼“å†²å®¹é‡ã€‚å½“å‘å°„é€Ÿåº¦å¿«äºæ”¶é›†é€Ÿåº¦æ—¶ï¼Œæ•°æ®ä¼šæš‚å­˜åœ¨è¿™é‡Œï¼Œé¿å…é˜»å¡å‘å°„è€…ã€‚</p>
</li>
<li>
<p>onBufferOverflow: BufferOverflowï¼šå½“ç¼“å†²åŒºï¼ˆreplay + extraBufferCapacityï¼‰æ»¡äº†ä¹‹åï¼Œå¦‚ä½•å¤„ç†æ–°æ•°æ®ã€‚</p>
<ul>
<li><strong>SUSPEND (é»˜è®¤)</strong>: æŒ‚èµ·ï¼ˆé˜»å¡ï¼‰å‘å°„è€…ï¼Œç›´åˆ°ç¼“å†²åŒºæœ‰ç©ºé—´ã€‚</li>
<li><strong>DROP_OLDEST</strong>: ä¸¢å¼ƒç¼“å†²åŒºä¸­æœ€æ—§çš„æ•°æ®ï¼Œä¸ºæ–°æ•°æ®è…¾å‡ºç©ºé—´ã€‚</li>
<li><strong>DROP_LATEST</strong>: ä¸¢å¼ƒæœ€æ–°çš„æ•°æ®ã€‚</li>
</ul>
</li>
</ol>
<hr>
<h3 id="4-ä»å†·åˆ°çƒ­çš„æ¡¥æ¢statein-å’Œ-sharein">4. ä»å†·åˆ°çƒ­çš„æ¡¥æ¢ï¼š<code>stateIn</code> å’Œ <code>shareIn</code></h3>
<p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¾ˆå°‘ç›´æ¥åˆ›å»º <code>MutableSharedFlow</code> æˆ– <code>MutableStateFlow</code>ã€‚æ›´å¸¸è§çš„åœºæ™¯æ˜¯ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªâ€œå†·â€çš„æ•°æ®æºï¼ˆæ¯”å¦‚ä» Room æ•°æ®åº“æŸ¥è¯¢æ•°æ®çš„ <code>Flow&#x3C;List&#x3C;User>></code>ï¼Œæˆ–è€…ä¸€æ¬¡æ€§çš„ç½‘ç»œè¯·æ±‚ï¼‰ï¼Œä½†æˆ‘ä»¬å¸Œæœ›å¤šä¸ªè®¢é˜…è€…èƒ½å¤Ÿé«˜æ•ˆåœ°å…±äº«è¿™ä»½æ•°æ®ï¼Œè€Œä¸æ˜¯æ¯æ¬¡è®¢é˜…éƒ½é‡æ–°è§¦å‘ä¸€æ¬¡æ•°æ®åº“æŸ¥è¯¢æˆ–ç½‘ç»œè¯·æ±‚ã€‚</p>
<p>è¿™æ—¶ï¼Œ<code>stateIn</code> å’Œ <code>shareIn</code> å°±æ´¾ä¸Šäº†ç”¨åœºã€‚å®ƒä»¬æ˜¯è½¬æ¢æ“ä½œç¬¦ï¼Œå¯ä»¥å°†ä»»æ„å†·æµï¼ˆCold Flowï¼‰è½¬æ¢ä¸ºçƒ­æµï¼ˆHot Flowï¼‰ã€‚</p>
<ul>
<li><strong><code>shareIn</code></strong>ï¼šå°†å†·æµè½¬æ¢ä¸º <code>SharedFlow</code>ã€‚å®ƒéå¸¸é€‚åˆå¹¿æ’­äº‹ä»¶æˆ–éœ€è¦å¤šä¸ªè®¢é˜…è€…å…±äº«ä½†æ²¡æœ‰â€œå½“å‰çŠ¶æ€â€æ¦‚å¿µçš„æ•°æ®ã€‚</li>
<li><strong><code>stateIn</code></strong>ï¼šå°†å†·æµè½¬æ¢ä¸º <code>StateFlow</code>ã€‚å®ƒåœ¨ <code>shareIn</code> çš„åŸºç¡€ä¸Šï¼Œé¢å¤–æä¾›äº†â€œçŠ¶æ€â€çš„ç‰¹æ€§ï¼Œå³å®ƒæ€»æ˜¯ä¼šç¼“å­˜æœ€æ–°çš„å€¼ã€‚è¿™è®©å®ƒæˆä¸º UI çŠ¶æ€ç®¡ç†çš„å®Œç¾é€‰æ‹©ã€‚</li>
</ul>
<p>è¿™ä¸¤ä¸ªæ“ä½œç¬¦çš„æ ¸å¿ƒåœ¨äºå®ƒä»¬çš„é…ç½®å‚æ•°ï¼Œå°¤å…¶æ˜¯ <code>SharingStarted</code> ç­–ç•¥ï¼Œå®ƒç²¾ç¡®åœ°å®šä¹‰äº†å†·æµä½•æ—¶å¯åŠ¨ä»¥åŠä½•æ—¶åœæ­¢ã€‚</p>
<h4 id="sharingstartedçƒ­æµçš„ç”Ÿå‘½å‘¨æœŸæ§åˆ¶å™¨"><code>SharingStarted</code>ï¼šçƒ­æµçš„ç”Ÿå‘½å‘¨æœŸæ§åˆ¶å™¨</h4>
<p><code>SharingStarted</code> å®šä¹‰äº†ä¸Šæ¸¸å†·æµä½•æ—¶å¼€å§‹å‘å°„æ•°æ®ï¼Œä»¥åŠåœ¨æ²¡æœ‰è®¢é˜…è€…æ—¶ä½•æ—¶åœæ­¢ã€‚</p>
<ol>
<li>
<p><strong><code>SharingStarted.Eagerly</code></strong></p>
<ul>
<li><strong>è¡Œä¸º</strong>ï¼šç«‹å³å¯åŠ¨ä¸Šæ¸¸å†·æµï¼Œå¹¶ä¸”æ°¸è¿œä¸ä¼šåœæ­¢ã€‚</li>
<li><strong>åœºæ™¯</strong>ï¼šé€‚ç”¨äºé‚£äº›å¿…é¡»ç«‹å³å¼€å§‹å¹¶æŒç»­è¿è¡Œçš„æ•°æ®æºï¼Œæ— è®ºæ˜¯å¦æœ‰ UI åœ¨è§‚å¯Ÿã€‚ä¾‹å¦‚ï¼ŒæŒç»­æ”¶é›†ä¼ æ„Ÿå™¨æ•°æ®å¹¶å†™å…¥æ—¥å¿—ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šå¦‚æœæ²¡æœ‰ä»»ä½•è®¢é˜…è€…ï¼Œä¼šæµªè´¹èµ„æºã€‚</li>
</ul>
</li>
<li>
<p><strong><code>SharingStarted.Lazily</code></strong></p>
<ul>
<li><strong>è¡Œä¸º</strong>ï¼šå½“ç¬¬ä¸€ä¸ªè®¢é˜…è€…å‡ºç°æ—¶å¯åŠ¨ä¸Šæ¸¸å†·æµï¼Œå¹¶ä¸”æ°¸è¿œä¸ä¼šåœæ­¢ã€‚</li>
<li><strong>åœºæ™¯</strong>ï¼šæ¯” <code>Eagerly</code> ç¨å¥½ï¼Œå¯ä»¥å»¶è¿Ÿå¯åŠ¨ã€‚ä½†ä¸€æ—¦å¯åŠ¨ï¼Œå³ä½¿æ‰€æœ‰è®¢é˜…è€…éƒ½ç¦»å¼€äº†ï¼Œå®ƒä¹Ÿä¸ä¼šåœæ­¢ã€‚</li>
<li><strong>ç¼ºç‚¹</strong>ï¼šåœ¨è®¢é˜…è€…æ¥äº†åˆèµ°çš„æƒ…å†µä¸‹ï¼ŒåŒæ ·ä¼šæµªè´¹èµ„æºã€‚</li>
</ul>
</li>
<li>
<p><strong><code>SharingStarted.WhileSubscribed(stopTimeoutMillis: Long = 0, replayExpirationMillis: Long = Long.MAX_VALUE)</code></strong></p>
<ul>
<li><strong>è¡Œä¸º</strong>ï¼šå½“ç¬¬ä¸€ä¸ªè®¢é˜…è€…å‡ºç°æ—¶å¯åŠ¨ï¼Œå½“æœ€åä¸€ä¸ªè®¢é˜…è€…æ¶ˆå¤±åï¼Œç­‰å¾… <code>stopTimeoutMillis</code> æ¯«ç§’ã€‚å¦‚æœåœ¨è¿™æœŸé—´æ²¡æœ‰æ–°çš„è®¢é˜…è€…å‡ºç°ï¼Œåˆ™åœæ­¢ä¸Šæ¸¸å†·æµã€‚</li>
<li><strong>ä¼˜åŠ¿</strong>ï¼šè¿™æ˜¯æœ€å¸¸ç”¨ã€æœ€é«˜æ•ˆçš„ç­–ç•¥ã€‚å®ƒå®Œç¾åœ°å¤„ç†äº† Android åº”ç”¨ä¸­çš„å±å¹•æ—‹è½¬ç­‰é…ç½®å˜æ›´ã€‚ä¾‹å¦‚ï¼Œå½“å±å¹•æ—‹è½¬æ—¶ï¼Œæ—§çš„ UI å®ä¾‹ä¼šå–æ¶ˆè®¢é˜…ï¼Œæ–°çš„ UI å®ä¾‹ä¼šé‡æ–°è®¢é˜…ã€‚å¦‚æœ <code>stopTimeoutMillis</code> è®¾ç½®ä¸º 5000msï¼ˆ5ç§’ï¼‰ï¼Œé‚£ä¹ˆåœ¨è¿™ 5 ç§’çš„é…ç½®å˜æ›´çª—å£æœŸå†…ï¼Œä¸Šæ¸¸å†·æµï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ï¼‰ä¸ä¼šè¢«å–æ¶ˆå’Œé‡å¯ï¼Œæ•°æ®å¾—ä»¥ä¿ç•™ï¼Œä»è€Œé¿å…äº†ä¸å¿…è¦çš„é‡å¤åŠ è½½ï¼Œå¹¶ä¿è¯äº† UI çš„æµç•…ã€‚</li>
</ul>
</li>
</ol>
<p><strong>ä»£ç ç¤ºä¾‹</strong>
å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªä»ç½‘ç»œè·å–ç”¨æˆ·åˆ—è¡¨çš„å†·æµï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="kotlin"><code><span class="line"><span style="color:#6A737D">// è¿™æ˜¯ä¸€ä¸ªå†·æµï¼Œæ¯æ¬¡ collect éƒ½ä¼šè§¦å‘ "Fetching data..."</span></span>
<span class="line"><span style="color:#F97583">val</span><span style="color:#E1E4E8"> userListFlow: </span><span style="color:#B392F0">Flow</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">List</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">String</span><span style="color:#E1E4E8">>> </span><span style="color:#F97583">=</span><span style="color:#B392F0"> flow</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    println</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Fetching data from network..."</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#B392F0">    delay</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">2000</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">// æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ</span></span>
<span class="line"><span style="color:#B392F0">    emit</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">listOf</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Alice"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"Bob"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"Charlie"</span><span style="color:#E1E4E8">))</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>åœ¨ ViewModel ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªçƒ­çš„ <code>StateFlow</code>ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="kotlin"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> MyViewModel</span><span style="color:#E1E4E8">(userRepository: </span><span style="color:#B392F0">UserRepository</span><span style="color:#E1E4E8">) : </span><span style="color:#B392F0">ViewModel</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // å°†å†·æµè½¬æ¢ä¸ºä¸€ä¸ªçƒ­çš„ StateFlow</span></span>
<span class="line"><span style="color:#F97583">    val</span><span style="color:#E1E4E8"> usersState: </span><span style="color:#B392F0">StateFlow</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">List</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">String</span><span style="color:#E1E4E8">>> </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> userRepository.</span><span style="color:#B392F0">getUsersFlow</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">        .</span><span style="color:#B392F0">stateIn</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">            scope </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> viewModelScope, </span><span style="color:#6A737D">// åœ¨ ViewModel çš„ç”Ÿå‘½å‘¨æœŸå†…è¿è¡Œ</span></span>
<span class="line"><span style="color:#E1E4E8">            started </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> SharingStarted.</span><span style="color:#B392F0">WhileSubscribed</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">5000</span><span style="color:#E1E4E8">), </span><span style="color:#6A737D">// æ™ºèƒ½å¯åœç­–ç•¥</span></span>
<span class="line"><span style="color:#E1E4E8">            initialValue </span><span style="color:#F97583">=</span><span style="color:#B392F0"> emptyList</span><span style="color:#E1E4E8">() </span><span style="color:#6A737D">// åˆå§‹å€¼ï¼Œåœ¨æ•°æ®è¿”å›å‰ UI å¯ä»¥æ˜¾ç¤ºç©ºåˆ—è¡¨</span></span>
<span class="line"><span style="color:#E1E4E8">        )</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œ<code>getUsersFlow()</code> åªä¼šåœ¨ç¬¬ä¸€ä¸ª UI è®¢é˜…è€…å‡ºç°æ—¶è¢«è°ƒç”¨ä¸€æ¬¡ã€‚åç»­çš„æ‰€æœ‰è®¢é˜…è€…ï¼ˆåŒ…æ‹¬å±å¹•æ—‹è½¬åé‡å»ºçš„ UIï¼‰éƒ½ä¼šå…±äº«è¿™åŒä¸€ä¸ªæ•°æ®æµå’Œå®ƒçš„æœ€æ–°çŠ¶æ€ã€‚</p>
<hr>
<h3 id="5-è·¨å¹³å°å®æˆ˜çƒ­æµçš„åº”ç”¨">5. è·¨å¹³å°å®æˆ˜ï¼šçƒ­æµçš„åº”ç”¨</h3>
<p>çƒ­æµï¼Œç‰¹åˆ«æ˜¯ <code>StateFlow</code> å’Œ <code>SharedFlow</code>ï¼Œæ˜¯ç°ä»£å“åº”å¼ç¼–ç¨‹çš„æ ¸å¿ƒï¼Œåœ¨ Android å’Œ Kotlin Multiplatform (KMP) é¡¹ç›®ä¸­æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ã€‚</p>
<h4 id="ui-çŠ¶æ€ç®¡ç†-stateflow"><strong>UI çŠ¶æ€ç®¡ç† (<code>StateFlow</code>)</strong></h4>
<p>åœ¨ MVVM (Model-View-ViewModel) æ¶æ„ä¸­ï¼ŒViewModel è´Ÿè´£å‡†å¤‡å¹¶ç®¡ç†ä¸ UI ç›¸å…³çš„æ•°æ®ã€‚<code>StateFlow</code> æ˜¯æš´éœ² UI çŠ¶æ€çš„ç†æƒ³é€‰æ‹©ã€‚</p>
<p><strong>åœºæ™¯</strong>: ä¸€ä¸ªå…¸å‹çš„ç”¨æˆ·èµ„æ–™é¡µé¢ï¼Œéœ€è¦å¤„ç†åŠ è½½ä¸­ã€åŠ è½½æˆåŠŸã€åŠ è½½å¤±è´¥ä¸‰ç§çŠ¶æ€ã€‚</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="kotlin"><code><span class="line"><span style="color:#6A737D">// 1. å®šä¹‰ UI çŠ¶æ€çš„å¯†å°ç±»</span></span>
<span class="line"><span style="color:#F97583">sealed</span><span style="color:#F97583"> interface</span><span style="color:#B392F0"> UserProfileUiState</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    object</span><span style="color:#B392F0"> Loading</span><span style="color:#E1E4E8"> : </span><span style="color:#B392F0">UserProfileUiState</span></span>
<span class="line"><span style="color:#F97583">    data</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Success</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">val</span><span style="color:#E1E4E8"> user: </span><span style="color:#B392F0">User</span><span style="color:#E1E4E8">) : </span><span style="color:#B392F0">UserProfileUiState</span></span>
<span class="line"><span style="color:#F97583">    data</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> Error</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">val</span><span style="color:#E1E4E8"> message: </span><span style="color:#B392F0">String</span><span style="color:#E1E4E8">) : </span><span style="color:#B392F0">UserProfileUiState</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// 2. åœ¨ ViewModel ä¸­ç®¡ç†å’Œæš´éœ²çŠ¶æ€</span></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> UserProfileViewModel</span><span style="color:#E1E4E8">(api: </span><span style="color:#B392F0">UserApi</span><span style="color:#E1E4E8">) : </span><span style="color:#B392F0">ViewModel</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#6A737D">    // ç§æœ‰çš„ã€å¯å˜çš„ MutableStateFlowï¼Œä»…åœ¨ ViewModel å†…éƒ¨ä¿®æ”¹</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> val</span><span style="color:#E1E4E8"> _uiState </span><span style="color:#F97583">=</span><span style="color:#B392F0"> MutableStateFlow</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">UserProfileUiState</span><span style="color:#E1E4E8">>(UserProfileUiState.Loading)</span></span>
<span class="line"><span style="color:#E1E4E8">    </span></span>
<span class="line"><span style="color:#6A737D">    // å…¬å¼€çš„ã€ä¸å¯å˜çš„ StateFlowï¼Œä¾› UI è®¢é˜…</span></span>
<span class="line"><span style="color:#F97583">    val</span><span style="color:#E1E4E8"> uiState: </span><span style="color:#B392F0">StateFlow</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">UserProfileUiState</span><span style="color:#E1E4E8">> </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> _uiState.</span><span style="color:#B392F0">asStateFlow</span><span style="color:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    init</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">        fetchUserProfile</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> fun</span><span style="color:#B392F0"> fetchUserProfile</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#E1E4E8">        viewModelScope.</span><span style="color:#B392F0">launch</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">            _uiState.</span><span style="color:#F97583">value</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> UserProfileUiState.Loading</span></span>
<span class="line"><span style="color:#F97583">            try</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">                val</span><span style="color:#E1E4E8"> user </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> api.</span><span style="color:#B392F0">getUser</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#E1E4E8">                _uiState.</span><span style="color:#F97583">value</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> UserProfileUiState.</span><span style="color:#B392F0">Success</span><span style="color:#E1E4E8">(user)</span></span>
<span class="line"><span style="color:#E1E4E8">            } </span><span style="color:#F97583">catch</span><span style="color:#E1E4E8"> (e: </span><span style="color:#B392F0">Exception</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">                _uiState.</span><span style="color:#F97583">value</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> UserProfileUiState.</span><span style="color:#B392F0">Error</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Failed to load user"</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>UI å±‚ (Jetpack Compose)</strong></p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="kotlin"><code><span class="line"><span style="color:#B392F0">@Composable</span></span>
<span class="line"><span style="color:#F97583">fun</span><span style="color:#B392F0"> UserProfileScreen</span><span style="color:#E1E4E8">(viewModel: </span><span style="color:#B392F0">UserProfileViewModel</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">    // a. collectAsStateWithLifecycle è‡ªåŠ¨å¤„ç†ç”Ÿå‘½å‘¨æœŸ</span></span>
<span class="line"><span style="color:#F97583">    val</span><span style="color:#E1E4E8"> uiState </span><span style="color:#F97583">by</span><span style="color:#E1E4E8"> viewModel.uiState.</span><span style="color:#B392F0">collectAsStateWithLifecycle</span><span style="color:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    when</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">val</span><span style="color:#E1E4E8"> state </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> uiState) {</span></span>
<span class="line"><span style="color:#F97583">        is</span><span style="color:#E1E4E8"> UserProfileUiState.Loading </span><span style="color:#F97583">-></span><span style="color:#B392F0"> ShowLoadingSpinner</span><span style="color:#E1E4E8">()</span></span>
<span class="line"><span style="color:#F97583">        is</span><span style="color:#E1E4E8"> UserProfileUiState.Success </span><span style="color:#F97583">-></span><span style="color:#B392F0"> ShowUserProfile</span><span style="color:#E1E4E8">(user </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> state.user)</span></span>
<span class="line"><span style="color:#F97583">        is</span><span style="color:#E1E4E8"> UserProfileUiState.Error </span><span style="color:#F97583">-></span><span style="color:#B392F0"> ShowError</span><span style="color:#E1E4E8">(message </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> state.message)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>ä¼˜åŠ¿</strong>:</p>
<ul>
<li><strong>å•ä¸€æ•°æ®æº</strong>: UI çš„æ‰€æœ‰çŠ¶æ€éƒ½æ¥è‡ª <code>uiState</code> è¿™ä¸€ä¸ªæµã€‚</li>
<li><strong>çŠ¶æ€ä¿ç•™</strong>: <code>StateFlow</code> ä¼šæŒæœ‰æœ€æ–°çŠ¶æ€ã€‚å½“å±å¹•æ—‹è½¬æ—¶ï¼Œæ–°çš„ UI ä¼šç«‹å³æ”¶åˆ°å½“å‰çš„çŠ¶æ€ï¼ˆä¾‹å¦‚ <code>Success</code> çŠ¶æ€ï¼‰ï¼Œè€Œä¸ä¼šé—ªçƒæˆ–æ˜¾ç¤ºé”™è¯¯çš„åŠ è½½ç•Œé¢ã€‚</li>
<li><strong>çº¿ç¨‹å®‰å…¨</strong>: ViewModel åœ¨åå°çº¿ç¨‹æ›´æ–°çŠ¶æ€ï¼ŒUI åœ¨ä¸»çº¿ç¨‹å®‰å…¨åœ°è§‚å¯Ÿå˜åŒ–ã€‚</li>
</ul>
<h4 id="ä¸€æ¬¡æ€§äº‹ä»¶é€šçŸ¥-sharedflow"><strong>ä¸€æ¬¡æ€§äº‹ä»¶é€šçŸ¥ (<code>SharedFlow</code>)</strong></h4>
<p>æœ‰æ—¶æˆ‘ä»¬éœ€è¦ä» ViewModel å‘ UI å‘é€ä¸€äº›â€œé˜…åå³ç„šâ€çš„äº‹ä»¶ï¼Œæ¯”å¦‚å¼¹å‡ºä¸€ä¸ª Toastã€æ˜¾ç¤ºä¸€ä¸ª Snackbar æˆ–è€…å¯¼èˆªåˆ°æ–°é¡µé¢ã€‚è¿™ç±»äº‹ä»¶ä¸åº”è¢«è§†ä¸ºâ€œçŠ¶æ€â€ã€‚å¦‚æœä½¿ç”¨ <code>StateFlow</code>ï¼Œå±å¹•æ—‹è½¬å UI ä¼šé‡æ–°æ”¶åˆ°æ—§çš„äº‹ä»¶ï¼Œå¯¼è‡´ Toast è¢«é‡å¤å¼¹å‡ºã€‚</p>
<p><code>SharedFlow</code> (é€šå¸¸ <code>replay = 0</code>) æ˜¯å¤„ç†è¿™ç±»äº‹ä»¶çš„å®Œç¾å·¥å…·ã€‚</p>
<p><strong>åœºæ™¯</strong>: ç”¨æˆ·ç‚¹å‡»â€œä¿å­˜â€æŒ‰é’®åï¼ŒViewModel ä¿å­˜æ•°æ®ï¼Œç„¶åé€šçŸ¥ UI æ˜¾ç¤ºâ€œä¿å­˜æˆåŠŸâ€çš„ Snackbarã€‚</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="kotlin"><code><span class="line"><span style="color:#6A737D">// åœ¨ ViewModel ä¸­</span></span>
<span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> EditProfileViewModel</span><span style="color:#E1E4E8">(repository: </span><span style="color:#B392F0">ProfileRepository</span><span style="color:#E1E4E8">) : </span><span style="color:#B392F0">ViewModel</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#F97583">    private</span><span style="color:#F97583"> val</span><span style="color:#E1E4E8"> _events </span><span style="color:#F97583">=</span><span style="color:#B392F0"> MutableSharedFlow</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">String</span><span style="color:#E1E4E8">>() </span><span style="color:#6A737D">// replay = 0 by default</span></span>
<span class="line"><span style="color:#F97583">    val</span><span style="color:#E1E4E8"> events: </span><span style="color:#B392F0">SharedFlow</span><span style="color:#E1E4E8">&#x3C;</span><span style="color:#B392F0">String</span><span style="color:#E1E4E8">> </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> _events.</span><span style="color:#B392F0">asSharedFlow</span><span style="color:#E1E4E8">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    fun</span><span style="color:#B392F0"> onSaveClick</span><span style="color:#E1E4E8">(newName: </span><span style="color:#B392F0">String</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">        viewModelScope.</span><span style="color:#B392F0">launch</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">            repository.</span><span style="color:#B392F0">saveName</span><span style="color:#E1E4E8">(newName)</span></span>
<span class="line"><span style="color:#E1E4E8">            _events.</span><span style="color:#B392F0">emit</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Profile saved successfully!"</span><span style="color:#E1E4E8">) </span><span style="color:#6A737D">// å‘å°„ä¸€æ¬¡æ€§äº‹ä»¶</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// åœ¨ UI å±‚ (Fragment æˆ– Composable)</span></span>
<span class="line"><span style="color:#6A737D">// ä½¿ç”¨ LaunchedEffect ä¿è¯åªåœ¨ key å˜åŒ–æˆ–é¦–æ¬¡ç»„åˆæ—¶æ‰§è¡Œä¸€æ¬¡è®¢é˜…</span></span>
<span class="line"><span style="color:#B392F0">LaunchedEffect</span><span style="color:#E1E4E8">(Unit) {</span></span>
<span class="line"><span style="color:#E1E4E8">    viewModel.events.</span><span style="color:#B392F0">collect</span><span style="color:#E1E4E8"> { message </span><span style="color:#F97583">-></span></span>
<span class="line"><span style="color:#6A737D">        // æ˜¾ç¤º Snackbar</span></span>
<span class="line"><span style="color:#E1E4E8">        scaffoldState.snackbarHostState.</span><span style="color:#B392F0">showSnackbar</span><span style="color:#E1E4E8">(message)</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p><strong>ä¼˜åŠ¿</strong>:</p>
<ul>
<li><strong>äº‹ä»¶ä¸é‡æ”¾</strong>: æ–°çš„è®¢é˜…è€…ï¼ˆæˆ–å±å¹•æ—‹è½¬åçš„ UIï¼‰ä¸ä¼šæ”¶åˆ°è¿‡å»çš„æ—§äº‹ä»¶ã€‚</li>
<li><strong>è§£è€¦</strong>: ViewModel åªè´Ÿè´£å‘å°„äº‹ä»¶ï¼Œä¸å…³å¿ƒè°åœ¨ç›‘å¬ä»¥åŠå¦‚ä½•å¤„ç†ã€‚</li>
<li><strong>å¹¿æ’­æœºåˆ¶</strong>: å¦‚æœæœ‰å¤šä¸ªè§‚å¯Ÿè€…ï¼Œå®ƒä»¬éƒ½å¯ä»¥åŒæ—¶æ”¶åˆ°è¿™ä¸ªäº‹ä»¶ã€‚</li>
</ul>
<hr>
<h3 id="6-ç»“è®ºå¦‚ä½•é€‰æ‹©å†·æµä¸çƒ­æµ">6. ç»“è®ºï¼šå¦‚ä½•é€‰æ‹©å†·æµä¸çƒ­æµ</h3>
<p>ç†è§£å†·æµå’Œçƒ­æµçš„åŒºåˆ«å¹¶çŸ¥é“ä½•æ—¶ä½¿ç”¨å®ƒä»¬ï¼Œæ˜¯ç¼–å†™é«˜æ•ˆã€å¥å£®çš„ Kotlin åç¨‹ä»£ç çš„å…³é”®ã€‚</p>



































<table><thead><tr><th align="left">ç‰¹æ€§</th><th align="left">å†·æµ (<code>Flow</code>)</th><th align="left">çƒ­æµ (<code>StateFlow</code> / <code>SharedFlow</code>)</th></tr></thead><tbody><tr><td align="left"><strong>æ‰§è¡Œæ—¶æœº</strong></td><td align="left">å½“ <code>collect</code> è¢«è°ƒç”¨æ—¶æ‰æ‰§è¡Œã€‚</td><td align="left">åˆ›å»ºåï¼ˆæˆ–æ ¹æ® <code>SharingStarted</code> ç­–ç•¥ï¼‰å°±ä¸»åŠ¨æ‰§è¡Œã€‚</td></tr><tr><td align="left"><strong>æ•°æ®å…±äº«</strong></td><td align="left">æ¯ä¸ª <code>collect</code> éƒ½æ˜¯ä¸€æ¬¡ç‹¬ç«‹çš„ã€å…¨æ–°çš„æ‰§è¡Œã€‚</td><td align="left">å¤šä¸ªè®¢é˜…è€…å…±äº«åŒä¸€ä¸ªæ•°æ®æµå®ä¾‹ã€‚</td></tr><tr><td align="left"><strong>çŠ¶æ€</strong></td><td align="left">æ— çŠ¶æ€ã€‚</td><td align="left"><strong>æœ‰çŠ¶æ€</strong>ã€‚<code>StateFlow</code> æ€»æ˜¯æŒæœ‰æœ€æ–°å€¼ã€‚</td></tr><tr><td align="left"><strong>è®¢é˜…è€…å…³ç³»</strong></td><td align="left">ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…æ˜¯ä¸€å¯¹ä¸€å…³ç³»ã€‚</td><td align="left">ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…æ˜¯ä¸€å¯¹å¤šå…³ç³»ï¼ˆå¹¿æ’­ï¼‰ã€‚</td></tr><tr><td align="left"><strong>ç”Ÿå‘½å‘¨æœŸ</strong></td><td align="left">ä¸è°ƒç”¨ <code>collect</code> çš„åç¨‹ç»‘å®šã€‚</td><td align="left">ç‹¬ç«‹äºè®¢é˜…è€…ï¼Œä¸åˆ›å»ºå®ƒçš„ <code>CoroutineScope</code> ç»‘å®šã€‚</td></tr></tbody></table>
<h4 id="é»„é‡‘åŸåˆ™é»˜è®¤ç”¨å†·æµéœ€è¦æ—¶æ‰è½¬çƒ­æµ"><strong>é»„é‡‘åŸåˆ™ï¼šé»˜è®¤ç”¨å†·æµï¼Œéœ€è¦æ—¶æ‰è½¬çƒ­æµ</strong></h4>
<ol>
<li>
<p><strong>é»˜è®¤ä½¿ç”¨å†·æµ (<code>Flow</code>)</strong>ï¼š
å¯¹äºå¤§å¤šæ•°ä¸€æ¬¡æ€§çš„æ•°æ®æ“ä½œï¼Œå¦‚æ‰§è¡Œä¸€æ¬¡ç½‘ç»œè¯·æ±‚ã€ä»æ•°æ®åº“è¯»å–ä¸€æ¬¡æ•°æ®æˆ–å¤„ç†æ–‡ä»¶ï¼Œå†·æµæ˜¯æœ€ç®€å•ã€æœ€å®‰å…¨çš„é€‰æ‹©ã€‚å®ƒä»¬éµå¾ªç»“æ„åŒ–å¹¶å‘ï¼Œå½“æ¶ˆè´¹è€…çš„ä½œç”¨åŸŸç»“æŸæ—¶ï¼Œå®ƒä»¬ä¼šè‡ªåŠ¨æ¸…ç†èµ„æºï¼Œä¸ä¼šé€ æˆèµ„æºæ³„æ¼ã€‚</p>
</li>
<li>
<p><strong>å½“éœ€è¦â€œå…±äº«â€æˆ–â€œçŠ¶æ€â€æ—¶ï¼Œæ‰ä½¿ç”¨çƒ­æµ</strong>ï¼š
åªæœ‰åœ¨ä»¥ä¸‹æ˜ç¡®çš„åœºæ™¯ä¸‹ï¼Œæ‰åº”è¯¥è€ƒè™‘å°†å†·æµé€šè¿‡ <code>stateIn</code> æˆ– <code>shareIn</code> è½¬æ¢ä¸ºçƒ­æµï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ <code>MutableStateFlow</code>/<code>MutableSharedFlow</code>ï¼š</p>
<ul>
<li><strong>UI çŠ¶æ€ç®¡ç†</strong>ï¼šå½“å¤šä¸ª UI ç»„ä»¶éœ€è¦è§‚å¯Ÿå¹¶å“åº”åŒä¸€ä¸ªåº”ç”¨çŠ¶æ€æ—¶ï¼Œä½¿ç”¨ <code>StateFlow</code>ã€‚</li>
<li><strong>æ˜‚è´µè®¡ç®—çš„å…±äº«</strong>ï¼šå½“ä¸€ä¸ªæ•°æ®æºï¼ˆå¦‚å¤æ‚çš„æ•°æ®åº“æŸ¥è¯¢ã€ç½‘ç»œè¯·æ±‚ï¼‰çš„åˆ›å»ºæˆæœ¬å¾ˆé«˜ï¼Œå¹¶ä¸”å…¶ç»“æœéœ€è¦è¢«å¤šä¸ªä¸‹æ¸¸æ¶ˆè´¹è€…å…±äº«æ—¶ï¼Œä½¿ç”¨ <code>shareIn</code> æˆ– <code>stateIn</code> æ¥é¿å…é‡å¤è®¡ç®—ã€‚</li>
<li><strong>äº‹ä»¶å¹¿æ’­</strong>ï¼šå½“ä½ éœ€è¦å‘å¤šä¸ªç›‘å¬å™¨å¹¿æ’­ä¸€æ¬¡æ€§äº‹ä»¶æ—¶ï¼ˆå¦‚ç”¨æˆ·æ“ä½œé€šçŸ¥ã€æ¨é€æ¶ˆæ¯ï¼‰ï¼Œä½¿ç”¨ <code>SharedFlow</code>ã€‚</li>
<li><strong>æŒç»­çš„æ•°æ®æº</strong>ï¼šå½“æ•°æ®æºæœ¬èº«å°±æ˜¯æŒç»­ä¸æ–­çš„ï¼ˆå¦‚ GPS ä½ç½®æ›´æ–°ã€è“ç‰™è®¾å¤‡ä¿¡å·ï¼‰ï¼Œå¹¶ä¸”éœ€è¦è¢«åº”ç”¨çš„å¤šä¸ªéƒ¨åˆ†ä½¿ç”¨æ—¶ï¼Œçƒ­æµæ˜¯è‡ªç„¶çš„é€‰æ‹©ã€‚</li>
</ul>
</li>
</ol>
<p>æ€»ä¹‹ï¼Œå°†å†·æµè§†ä¸ºåŸºç¡€æ„å»ºå—ï¼Œå°†çƒ­æµè§†ä¸ºä¸€ç§ä¸ºå®ç°çŠ¶æ€å…±äº«å’Œé«˜æ•ˆå¹¿æ’­è€Œç”Ÿçš„ç‰¹æ®Šå·¥å…·ã€‚æ­£ç¡®åœ°è¿ç”¨å®ƒä»¬ï¼Œå°†ä½¿ä½ çš„åº”ç”¨é€»è¾‘æ›´åŠ æ¸…æ™°ã€æ€§èƒ½æ›´é«˜ã€‚</p>  </article> <div class="tags"> <div class="_tailmateTag_u5zwa_5"> <a href="/blog/tag/Kotlin/">Kotlin</a> </div><div class="_tailmateTag_u5zwa_5"> <a href="/blog/tag/Kotlin åç¨‹/">Kotlin åç¨‹</a> </div><div class="_tailmateTag_u5zwa_5"> <a href="/blog/tag/å“åº”å¼ç¼–ç¨‹/">å“åº”å¼ç¼–ç¨‹</a> </div><div class="_tailmateTag_u5zwa_5"> <a href="/blog/tag/å¼‚æ­¥ç¼–ç¨‹/">å¼‚æ­¥ç¼–ç¨‹</a> </div><div class="_tailmateTag_u5zwa_5"> <a href="/blog/tag/è½¯ä»¶æ¶æ„/">è½¯ä»¶æ¶æ„</a> </div><div class="_tailmateTag_u5zwa_5"> <a href="/blog/tag/å‘å¸ƒè®¢é˜…/">å‘å¸ƒè®¢é˜…</a> </div><div class="_tailmateTag_u5zwa_5"> <a href="/blog/tag/æ€§èƒ½ä¼˜åŒ–/">æ€§èƒ½ä¼˜åŒ–</a> </div> </div> </main> </div> <div class="okTgGW_footer"> <p>Supported and developed by&nbsp;
<a href="https://github.com/misakamayako/" target="_blank" rel="noreferrer">misaka mayako</a> </p> <p>
Tech with <a href="https://astro.build/" target="_blank" rel="noreferrer">astro</a>,&nbsp;
<a href="https://tailwindcss.com/" target="_blank" rel="noreferrer">tailwindcss</a>,&nbsp;
        and <a href="https://pm2.keymetrics.io/" target="_blank" rel="noreferrer">pm2</a>,&nbsp;
</p> <p> feed back via <a href="mailto:misakamayaco@qq.com" target="_blank" rel="noreferrer">ğŸ“«</a></p> <a rel="license noreferrer" href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" class="absolute right-6 bottom-6"> <img alt="çŸ¥è¯†å…±äº«è®¸å¯åè®®" class="inlin-block border-0" src="/cc4.0.png"> </a> </div> </div> <script type="module" is:global>
        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('pre').forEach((block) => {
                const button = document.createElement('button')
                button.innerText = 'å¤åˆ¶'
                button.className =
                    'absolute top-2 right-2 bg-slate-800 text-white px-2 py-1 rounded text-sm opacity-50 hover:opacity-100 transition cursor-pointer'
                button.addEventListener('click', () => {
                    const code = block.querySelector('code')
                    if (code) {
                        navigator.clipboard.writeText(code.innerText).then(() => {
                            button.innerText = 'å·²å¤åˆ¶ï¼'
                            setTimeout(() => (button.innerText = 'å¤åˆ¶'), 1000)
                        })
                    }
                })
                block.classList.add('relative')
                block.appendChild(button)
            })
        })
    </script>  </body></html>